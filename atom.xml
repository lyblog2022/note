<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>My Note</title>
  
  <subtitle>Welcome To My World</subtitle>
  <link href="https://lyblog2022.github.io/atom.xml" rel="self"/>
  
  <link href="https://lyblog2022.github.io/"/>
  <updated>2022-06-21T14:29:04.445Z</updated>
  <id>https://lyblog2022.github.io/</id>
  
  <author>
    <name>ly</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>nginx初步学习</title>
    <link href="https://lyblog2022.github.io/2022/06/21/study/nginx/nginx1/"/>
    <id>https://lyblog2022.github.io/2022/06/21/study/nginx/nginx1/</id>
    <published>2022-06-21T13:44:31.000Z</published>
    <updated>2022-06-21T14:29:04.445Z</updated>
    
    <content type="html"><![CDATA[<p>nginx简介及常用命令</p><span id="more"></span><h3 id="1、nginx简介"><a href="#1、nginx简介" class="headerlink" title="1、nginx简介"></a>1、nginx简介</h3><p>​Nginx是一个高性能的Web服务器和反向代理的软件</p><p>​Web服务器：就是运行我们web服务的容器，提供web功能，还有tomcat也提供类似的功能。</p><p>​代理是软件架构和网络设计中，非常重要的一个概念。有两种代理：正向代理和反向代理。</p><h4 id="1-1-正向代理"><a href="#1-1-正向代理" class="headerlink" title="1.1 正向代理"></a>1.1 正向代理</h4><p>​用户端设置代理服务器。</p><p>​所有的请求都由代理服务器发出，无法判断代理了多少用户端，叫正向代理</p><h4 id="1-2-反向代理"><a href="#1-2-反向代理" class="headerlink" title="1.2 反向代理"></a>1.2 反向代理</h4><p>​和正向代理相反：在服务端设置代理，所有请求，由服务端接受，然后再由代理服务器发到后方的服务器。</p><p>​这么一来，所有请求，都由一个服务器接收，无法判断代理了多少服务端。这就是反向代 理。 </p><p>​利用反向代理，就可以将请求分发到系统内部的多个节点上，从而减少每个节点的并发数。</p><p>​而这些节点在外界看来，就是一个系统，表现出唯一的ip，也就是代理服务器的IP。 </p><h4 id="1-3-发展历程"><a href="#1-3-发展历程" class="headerlink" title="1.3 发展历程"></a>1.3 发展历程</h4><p>​最初是由一个俄罗斯人（Igor Sysoev：伊戈尔 塞索耶夫）开发的。</p><p>​Nginx的第一个版本发布于 2004年，因其系统资源消耗低、运行稳定，且具有高性能的并发处理能力等特性，Nginx在互联网 企业中得到广泛应用。</p><p>​Nginx是互联网上最受欢迎的开源Web服务器之一，Netcraft公司2019年7月 的统计数据表明，Nginx为全球最繁忙网站中的25.42%提供了服务或代理。得益于近几年云计算和 微服务的快速发展，Nginx因在其中发挥了自身优势而得到广泛应用，且有望在未来占有更多的市场 份额。 </p><p>​2019年3月，著名硬件负载均衡厂商F5宣布收购Nginx，Nginx成为F5的一部分。</p><h3 id="2、nginx启动及验证"><a href="#2、nginx启动及验证" class="headerlink" title="2、nginx启动及验证"></a>2、nginx启动及验证</h3><h4 id="2-1-找到命令目录"><a href="#2-1-找到命令目录" class="headerlink" title="2.1 找到命令目录"></a>2.1 找到命令目录</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# pwd</span><br><span class="line">/usr/local/nginx/sbin</span><br></pre></td></tr></table></figure><h4 id="2-2-启动"><a href="#2-2-启动" class="headerlink" title="2.2 启动"></a>2.2 启动</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# ./nginx</span><br><span class="line">ngx_http_fastdfs_set pid=13620</span><br><span class="line">[root@192 sbin]# ps -ef | grep nginx</span><br><span class="line">root       13621       1  0 10:01 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">root       13622   13621  0 10:01 ?        00:00:00 nginx: worker process</span><br><span class="line">root       13628    3146  0 10:01 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><h4 id="2-3-启动验证"><a href="#2-3-启动验证" class="headerlink" title="2.3 启动验证"></a>2.3 启动验证</h4><img src="/2022/06/21/study/nginx/nginx1/nginx2.png" class="" title="nginx2 image"><p>本机访问：<a href="http://192.168.213.133:8888/">Welcome to nginx!</a></p><img src="/2022/06/21/study/nginx/nginx1/nginx3.png" class="" title="nginx3 image"><h4 id="2-4-关闭"><a href="#2-4-关闭" class="headerlink" title="2.4 关闭"></a>2.4 关闭</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# ./nginx -s quit</span><br><span class="line">ngx_http_fastdfs_set pid=13727</span><br><span class="line">[root@192 sbin]# ps -ef | grep nginx</span><br><span class="line">root       13729    3146  0 10:07 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><h3 id="3、nginx常用命令"><a href="#3、nginx常用命令" class="headerlink" title="3、nginx常用命令"></a>3、nginx常用命令</h3><h4 id="3-1-查看版本号"><a href="#3-1-查看版本号" class="headerlink" title="3.1 查看版本号"></a>3.1 查看版本号</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# ./nginx -v</span><br><span class="line">nginx version: nginx/1.16.1</span><br></pre></td></tr></table></figure><h4 id="3-2-关闭nginx"><a href="#3-2-关闭nginx" class="headerlink" title="3.2 关闭nginx"></a>3.2 关闭nginx</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# ./nginx -s quit</span><br><span class="line">[root@192 sbin]# ./nginx -s stop</span><br><span class="line">ngx_http_fastdfs_set pid=13727</span><br><span class="line">[root@192 sbin]# ps -ef | grep nginx</span><br><span class="line">root       13729    3146  0 10:07 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><h4 id="3-3-启动Nginx命令"><a href="#3-3-启动Nginx命令" class="headerlink" title="3.3 启动Nginx命令"></a>3.3 启动Nginx命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# ./nginx</span><br><span class="line">ngx_http_fastdfs_set pid=13620</span><br><span class="line">[root@192 sbin]# ps -ef | grep nginx</span><br><span class="line">root       13621       1  0 10:01 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">root       13622   13621  0 10:01 ?        00:00:00 nginx: worker process</span><br><span class="line">root       13628    3146  0 10:01 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure><h4 id="3-4-重新加载配置文件"><a href="#3-4-重新加载配置文件" class="headerlink" title="3.4 重新加载配置文件"></a>3.4 重新加载配置文件</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@192 sbin]# ./nginx -s reload</span><br><span class="line">ngx_http_fastdfs_set pid=13917</span><br></pre></td></tr></table></figure><h3 id="4、配置文件"><a href="#4、配置文件" class="headerlink" title="4、配置文件"></a>4、配置文件</h3><p>找到nginx配置文件：&#x2F;etc&#x2F;nginx</p><p>指令种类：</p><pre><code>+ 简单指令：+ 块指令：</code></pre><p>全局块：就是最开始的简单指令。从配置文件开始到events</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user</span> <span class="string">nginx;</span></span><br><span class="line"><span class="attr">worker_processes</span> <span class="string">auto;</span></span><br><span class="line"><span class="attr">error_log</span> <span class="string">/var/log/nginx/error.log notice;</span></span><br><span class="line"><span class="attr">pid</span> <span class="string">/var/run/nginx.pid;</span></span><br></pre></td></tr></table></figure><p>events块：配置服务器和用户网络连接相关的参数。</p><p>http块：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http</span> <span class="string">&#123;</span></span><br><span class="line"> <span class="attr">include</span> <span class="string">/etc/nginx/mime.types;</span></span><br><span class="line"> <span class="attr">default_type</span> <span class="string">application/octet-stream;</span></span><br><span class="line"> <span class="attr">log_format</span> <span class="string">main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line"> <span class="attr">&#x27;$status</span> <span class="string">$body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line"> <span class="attr">&#x27;&quot;$http_user_agent&quot;</span> <span class="string">&quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"> <span class="attr">access_log</span> <span class="string">/var/log/nginx/access.log main;</span></span><br><span class="line"> <span class="attr">sendfile</span> <span class="string">on;</span></span><br><span class="line"><span class="comment"> #tcp_nopush on;</span></span><br><span class="line"> <span class="attr">keepalive_timeout</span> <span class="string">65;</span></span><br><span class="line"><span class="comment"> #gzip on;</span></span><br><span class="line"> <span class="attr">include</span> <span class="string">/etc/nginx/conf.d/*.conf;</span></span><br><span class="line"><span class="comment"> # server块可以是 多个</span></span><br><span class="line"> <span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line"> <span class="attr">listen</span> <span class="string">80;</span></span><br><span class="line"><span class="comment"> # server_name 127.0.0.1;</span></span><br><span class="line"> <span class="attr">server_name</span> <span class="string">www.cpf.com;</span></span><br><span class="line"><span class="comment"> # location 块可以是 多 个</span></span><br><span class="line"> <span class="attr">location</span> <span class="string">/ &#123;</span></span><br><span class="line"> <span class="attr">proxy_pass</span> <span class="string">http://127.0.0.1:8080;</span></span><br><span class="line"> <span class="attr">&#125;</span></span><br><span class="line"> <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;nginx简介及常用命令&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="nginx" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/nginx/"/>
    
    
    <category term="nginx" scheme="https://lyblog2022.github.io/tags/nginx/"/>
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>高并发场景下的 httpClient 优化使用</title>
    <link href="https://lyblog2022.github.io/2022/06/21/summary/High-concurrency/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84httpClient%E4%BC%98%E5%8C%96%E4%BD%BF%E7%94%A8/"/>
    <id>https://lyblog2022.github.io/2022/06/21/summary/High-concurrency/%E9%AB%98%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84httpClient%E4%BC%98%E5%8C%96%E4%BD%BF%E7%94%A8/</id>
    <published>2022-06-21T01:59:25.000Z</published>
    <updated>2022-06-21T13:36:39.706Z</updated>
    
    <content type="html"><![CDATA[<p>高并发场景下的 httpClient 优化使用，参考自：<a href="https://blog.csdn.net/u010285974/article/details/85696239">仰望星空的尘埃</a></p><span id="more"></span><h4 id="1、HttpClient优化思路"><a href="#1、HttpClient优化思路" class="headerlink" title="1、HttpClient优化思路"></a>1、<code>HttpClient</code>优化思路</h4><ol><li>池化</li><li>长链接</li><li><code>httpclient</code>和<code>httpget</code>复用</li><li>合理的配置参数（最大并发请求数、各种超时时间、重试次数）</li><li>异步</li><li>源码</li></ol><h4 id="2、分析"><a href="#2、分析" class="headerlink" title="2、分析"></a>2、分析</h4><p>​原始的使用比较简单，即每次请求时初始化一个<code>httpclient</code>，生成一个<code>httppost</code>对象，执行，然后从返回结果中取出<code>entity</code>，保存成一个字符串，最后显示关闭<code>response</code>和<code>client</code></p><h5 id="2-1-httpclient反复创建开销"><a href="#2-1-httpclient反复创建开销" class="headerlink" title="2.1 httpclient反复创建开销"></a>2.1 <code>httpclient</code>反复创建开销</h5><p>​<code>httpclient</code>是一个线程安全的类，没有必要由每个线程在每次使用时创建，全局保留一个即可</p><h5 id="2-2-反复创建tcp连接的开销"><a href="#2-2-反复创建tcp连接的开销" class="headerlink" title="2.2 反复创建tcp连接的开销"></a>2.2 反复创建<code>tcp</code>连接的开销</h5><p>​<code>tcp</code>的三次握手四次挥手两大过程，对于高频词的请求来说，消耗过大，如果每次请求需要花费5ms用于协商过程，那么对于<code>qps</code>为100的单系统，1秒钟就要花费500ms用于握手和挥手，<code>so</code>改成<code>keep alive</code>的方式实现连接复用</p><h4 id="2-3-重复缓存entity的开销"><a href="#2-3-重复缓存entity的开销" class="headerlink" title="2.3 重复缓存entity的开销"></a>2.3 重复缓存<code>entity</code>的开销</h4><p>​一般情况下，使用了以下的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">resultString</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure><p>​这里相当于额外复制了一份<code>content</code>到一个字符串内，而原本的<code>httpResponse</code>仍然保留了一份<code>content</code>，需要被<code>consume</code>掉，在高并发且<code>content</code>非常大的情况下，会消耗大量内存，并且需要显示的关闭链接</p><h4 id="3、实现"><a href="#3、实现" class="headerlink" title="3、实现"></a>3、实现</h4><p>按照上面的分析，主要完成三件事：</p><ul><li>单例的<code>client</code></li><li>缓存的保持链接</li><li>更好的处理返回结果</li></ul><p>提到连接缓存，很容易想到数据库连接池。<code>httpclient4</code>提供了一个<code>PoolngHttpClientConnectionManager</code>作为连接池。通过以下步骤进行优化</p><h5 id="3-1-定义一个keep-alive-strategy"><a href="#3-1-定义一个keep-alive-strategy" class="headerlink" title="3.1 定义一个keep alive strategy"></a>3.1 定义一个<code>keep alive strategy</code></h5><p>​是否使用<code>keep-alive</code>要根据业务情况来定，其并不是灵丹妙药，而且<code>keep-alive</code>和<code>time_wait/close_wait</code>之间也有不少故事</p><p>​在本业务场景下，相当于有少数固定的客户端，长时间高频次的访问服务器，启用<code>keep-alive</code>非常合适</p><p>​【注意】 <code>http</code>的<code>keep-alive</code>与<code>tcp</code>的<code>KEEPALIVE</code>不是一个东西</p><p>定义一个<code>strategy</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConnectionKeepAliveStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionKeepAliveStrategy</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getKeepAliveDuration</span><span class="params">(HttpResponse response, HttpContext context)</span> &#123;</span><br><span class="line">        <span class="type">HeaderElementIterator</span> <span class="variable">iterator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicHeaderElementIterator</span>(response.headerIterator(HTTP.CONN_KEEP_ALIVE));</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">HeaderElement</span> <span class="variable">element</span> <span class="operator">=</span> iterator.nextElement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> element.getName();</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> element.getValue();</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="literal">null</span> &amp;&amp; param.equalsIgnoreCase(<span class="string">&quot;timeout&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Long.parseLong(value) * <span class="number">1000</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//默认时长为60s</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="3-2-配置一个PoolingHttpClientConnectionManager"><a href="#3-2-配置一个PoolingHttpClientConnectionManager" class="headerlink" title="3.2 配置一个PoolingHttpClientConnectionManager"></a>3.2 配置一个<code>PoolingHttpClientConnectionManager</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">connectionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line">connectionManager.setMaxTotal(<span class="number">500</span>);</span><br><span class="line"><span class="comment">//默认每个路由最高50并发，也可以针对每个路由设置并发数。</span></span><br><span class="line">connectionManager.setDefaultMaxPerRoute(<span class="number">50</span>);</span><br></pre></td></tr></table></figure><h5 id="3-3-生成httpclient"><a href="#3-3-生成httpclient" class="headerlink" title="3.3 生成httpclient"></a>3.3 生成<code>httpclient</code></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpClientBuilder</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom();</span><br><span class="line">httpClient.setConnectionManager(connectionManager);</span><br><span class="line">httpClient.setKeepAliveStrategy(strategy);</span><br><span class="line">httpClient.setDefaultRequestConfig(RequestConfig.custom().setStaleConnectionCheckEnabled(<span class="literal">true</span>).build());</span><br></pre></td></tr></table></figure><p>【注意】：使用<code>setStaleConnectionCheckEnabled</code>方法来逐出已被关闭的链接不被推荐。更好的方式是手动启用一个线程，定时运行<code>closeExpiredConnections </code>和<code>closeIdleConnections</code>方法，如下所示。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IdleConnectionMonitorThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpClientConnectionManager manager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> shutdown;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IdleConnectionMonitorThread</span><span class="params">(HttpClientConnectionManager manager)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="built_in">this</span>.manager = manager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span>(!shutdown)&#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (<span class="built_in">this</span>)&#123;</span><br><span class="line">                    wait(<span class="number">5000</span>);</span><br><span class="line">                    manager.closeExpiredConnections();</span><br><span class="line">                    manager.closeIdleConnections(<span class="number">30</span>, TimeUnit.SECONDS);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        shutdown = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>)&#123;</span><br><span class="line">            notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3-4-使用httpclient执行method时降低开销"><a href="#3-4-使用httpclient执行method时降低开销" class="headerlink" title="3.4 使用httpclient执行method时降低开销"></a>3.4 使用<code>httpclient</code>执行<code>method</code>时降低开销</h5><p>这里要注意的是，不要关闭<code>connection</code>。</p><p>一种可行的获取内容的方式类似于，把<code>entity</code>里的东西复制一份：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = EntityUtils.toString(response.getEntity(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">EntityUtils.consume(response1.getEntity());</span><br></pre></td></tr></table></figure><p>但是，更推荐的方式是定义一个<code>ResponseHandler</code>，其相关源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">execute</span><span class="params">(<span class="keyword">final</span> HttpHost target, <span class="keyword">final</span> HttpRequest request,</span></span><br><span class="line"><span class="params">           <span class="keyword">final</span> ResponseHandler&lt;? extends T&gt; responseHandler, <span class="keyword">final</span> HttpContext context)</span></span><br><span class="line">           <span class="keyword">throws</span> IOException, ClientProtocolException &#123;</span><br><span class="line">       Args.notNull(responseHandler, <span class="string">&quot;Response handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> execute(target, request, context);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> T result;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           result = responseHandler.handleResponse(response);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception t) &#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               EntityUtils.consume(entity);</span><br><span class="line">           &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception t2) &#123;</span><br><span class="line">               <span class="comment">// Log this exception. The original exception is more</span></span><br><span class="line">               <span class="comment">// important and will be thrown to the caller.</span></span><br><span class="line">               <span class="built_in">this</span>.log.warn(<span class="string">&quot;Error consuming content after an exception.&quot;</span>, t2);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (t <span class="keyword">instanceof</span> RuntimeException) &#123;</span><br><span class="line">               <span class="keyword">throw</span> (RuntimeException) t;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (t <span class="keyword">instanceof</span> IOException) &#123;</span><br><span class="line">               <span class="keyword">throw</span> (IOException) t;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(t);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Handling the response was successful. Ensure that the content has</span></span><br><span class="line">       <span class="comment">// been fully consumed.</span></span><br><span class="line">       <span class="keyword">final</span> <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">       <span class="comment">//</span></span><br><span class="line">       EntityUtils.consume(entity);</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>​可以看到，如果我们使用<code>resultHandler</code>执行<code>execute</code>方法，会最终自动调用<code>consume</code>方法，而这个<code>consume</code>方法如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">consume</span><span class="params">(<span class="keyword">final</span> HttpEntity entity)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="keyword">if</span> (entity == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (entity.isStreaming()) &#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="type">InputStream</span> <span class="variable">instream</span> <span class="operator">=</span> entity.getContent();</span><br><span class="line">           <span class="keyword">if</span> (instream != <span class="literal">null</span>) &#123;</span><br><span class="line">               instream.close();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>​可以看到最终它关闭了输入流。</p><h4 id="4、其他"><a href="#4、其他" class="headerlink" title="4、其他"></a>4、其他</h4><p>​通过以上步骤，基本就完成了一个支持高并发的<code>httpclient</code>的写法，下面是一些额外的配置和提醒：</p><h5 id="4-1-httpclient的一些超时配置"><a href="#4-1-httpclient的一些超时配置" class="headerlink" title="4.1 httpclient的一些超时配置"></a>4.1 <code>httpclient</code>的一些超时配置</h5><p>​<code>CONNECTION_TIMEOUT</code>是连接超时时间，<code>SO_TIMEOUT</code>是<code>socket</code>超时时间，这两者是不同的。连接超时时间是发起请求前的等待时间；<code>socket</code>超时时间是等待数据的超时时间。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpParams</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicHttpParams</span>();</span><br><span class="line"><span class="comment">//设置连接超时时间</span></span><br><span class="line"><span class="comment">//设置请求超时2秒钟 根据业务调整</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">CONNECTION_TIMEOUT</span> <span class="operator">=</span> <span class="number">2</span> * <span class="number">1000</span>; </span><br><span class="line"><span class="comment">//设置等待数据超时时间2秒钟 根据业务调整</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">SO_TIMEOUT</span> <span class="operator">=</span> <span class="number">2</span> * <span class="number">1000</span>; </span><br><span class="line"> </span><br><span class="line"><span class="comment">//定义了当从ClientConnectionManager中检索ManagedClientConnection实例时使用的毫秒级的超时时间</span></span><br><span class="line"><span class="comment">//这个参数期望得到一个java.lang.Long类型的值。如果这个参数没有被设置，默认等于CONNECTION_TIMEOUT，因此一定要设置。</span></span><br><span class="line"><span class="comment">//在httpclient4.2.3中我记得它被改成了一个对象导致直接用long会报错，后来又改回来了</span></span><br><span class="line"><span class="type">Long</span> <span class="variable">CONN_MANAGER_TIMEOUT</span> <span class="operator">=</span> <span class="number">500L</span>; </span><br><span class="line"> </span><br><span class="line">params.setIntParameter(CoreConnectionPNames.CONNECTION_TIMEOUT, CONNECTION_TIMEOUT);</span><br><span class="line">params.setIntParameter(CoreConnectionPNames.SO_TIMEOUT, SO_TIMEOUT);</span><br><span class="line">params.setLongParameter(ClientPNames.CONN_MANAGER_TIMEOUT, CONN_MANAGER_TIMEOUT);</span><br><span class="line"><span class="comment">//在提交请求之前 测试连接是否可用</span></span><br><span class="line">params.setBooleanParameter(CoreConnectionPNames.STALE_CONNECTION_CHECK, <span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//另外设置http client的重试次数，默认是3次；当前是禁用掉（如果项目量不到，这个默认即可）</span></span><br><span class="line">httpClient.setHttpRequestRetryHandler(<span class="keyword">new</span> <span class="title class_">DefaultHttpRequestRetryHandler</span>(<span class="number">0</span>, <span class="literal">false</span>));</span><br></pre></td></tr></table></figure><h5 id="4-2-如果配置了nginx的话，nginx也要设置面向两端的keep-alive"><a href="#4-2-如果配置了nginx的话，nginx也要设置面向两端的keep-alive" class="headerlink" title="4.2 如果配置了nginx的话，nginx也要设置面向两端的keep-alive"></a>4.2 如果配置了<code>nginx</code>的话，<code>nginx</code>也要设置面向两端的<code>keep-alive</code></h5><p>​现在的业务里，没有<code>nginx</code>的情况反而比较稀少。<code>nginx</code>默认和<code>client</code>端打开长连接而和<code>server</code>端使用短链接。注意<code>client</code>端的<code>keepalive_timeout</code>和<code>keepalive_requests</code>参数，以及<code>upstream</code>端的<code>keepalive</code>参数设置</p><p>​依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- httpclient --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Basic认证</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">CredentialsProvider</span> <span class="variable">credsProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicCredentialsProvider</span>();</span><br><span class="line"><span class="comment">//httpClient</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> CloseableHttpClient httpclient;</span><br><span class="line"><span class="comment">//httpGet方法</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> HttpGet httpget;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> RequestConfig reqestConfig;</span><br><span class="line"><span class="comment">//响应处理器</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ResponseHandler&lt;String&gt; responseHandler;</span><br><span class="line"><span class="comment">//jackson解析工具</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;http.maxConnections&quot;</span>,<span class="string">&quot;50&quot;</span>);</span><br><span class="line">    System.setProperty(<span class="string">&quot;http.keepAlive&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">    <span class="comment">//设置basic校验</span></span><br><span class="line">    credsProvider.setCredentials(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AuthScope</span>(AuthScope.ANY_HOST, AuthScope.ANY_PORT, AuthScope.ANY_REALM),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="comment">//创建http客户端</span></span><br><span class="line">    httpclient = HttpClients.custom()</span><br><span class="line">            .useSystemProperties()</span><br><span class="line">            .setRetryHandler(<span class="keyword">new</span> <span class="title class_">DefaultHttpRequestRetryHandler</span>(<span class="number">3</span>,<span class="literal">true</span>))</span><br><span class="line">            .setDefaultCredentialsProvider(credsProvider)</span><br><span class="line">            .build();</span><br><span class="line">    <span class="comment">//初始化httpGet</span></span><br><span class="line">    httpget = <span class="keyword">new</span> <span class="title class_">HttpGet</span>();</span><br><span class="line">    <span class="comment">//初始化HTTP请求配置</span></span><br><span class="line">    reqestConfig = RequestConfig.custom()</span><br><span class="line">            .setContentCompressionEnabled(<span class="literal">true</span>)</span><br><span class="line">            .setSocketTimeout(<span class="number">100</span>)</span><br><span class="line">            .setAuthenticationEnabled(<span class="literal">true</span>)</span><br><span class="line">            .setConnectionRequestTimeout(<span class="number">100</span>)</span><br><span class="line">            .setConnectTimeout(<span class="number">100</span>).build();</span><br><span class="line">    httpget.setConfig(reqestConfig);</span><br><span class="line">    <span class="comment">//初始化response解析器</span></span><br><span class="line">    responseHandler = <span class="keyword">new</span> <span class="title class_">BasicResponseHandler</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 功能：返回响应</span></span><br><span class="line"><span class="comment"> * @author zhangdaquan</span></span><br><span class="line"><span class="comment"> * @date 2019/1/3 上午11:19</span></span><br><span class="line"><span class="comment"> * @param [url]</span></span><br><span class="line"><span class="comment"> * @return org.apache.http.client.methods.CloseableHttpResponse</span></span><br><span class="line"><span class="comment"> * @exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getResponse</span><span class="params">(String url)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">HttpGet</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">    <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> httpclient.execute(get,responseHandler);</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 功能：发送http请求，并用net.sf.json工具解析</span></span><br><span class="line"><span class="comment"> * @author zhangdaquan</span></span><br><span class="line"><span class="comment"> * @date 2018/8/15 下午2:21</span></span><br><span class="line"><span class="comment"> * @param [url]</span></span><br><span class="line"><span class="comment"> * @return org.json.JSONObject</span></span><br><span class="line"><span class="comment"> * @exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> JSONObject <span class="title function_">getUrl</span><span class="params">(String url)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        httpget.setURI(URI.create(url));</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> httpclient.execute(httpget,responseHandler);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">json</span> <span class="operator">=</span> JSONObject.fromObject(response);</span><br><span class="line">        <span class="keyword">return</span> json;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 功能：发送http请求，并用jackson工具解析</span></span><br><span class="line"><span class="comment"> * @author zhangdaquan</span></span><br><span class="line"><span class="comment"> * @date 2018/12/24 下午2:58</span></span><br><span class="line"><span class="comment"> * @param [url]</span></span><br><span class="line"><span class="comment"> * @return com.fasterxml.jackson.databind.JsonNode</span></span><br><span class="line"><span class="comment"> * @exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> JsonNode <span class="title function_">getUrl2</span><span class="params">(String url)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        httpget.setURI(URI.create(url));</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> httpclient.execute(httpget,responseHandler);</span><br><span class="line">        <span class="type">JsonNode</span> <span class="variable">node</span> <span class="operator">=</span> mapper.readTree(response);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 功能：发送http请求，并用fastjson工具解析</span></span><br><span class="line"><span class="comment"> * @author zhangdaquan</span></span><br><span class="line"><span class="comment"> * @date 2018/12/24 下午2:58</span></span><br><span class="line"><span class="comment"> * @param [url]</span></span><br><span class="line"><span class="comment"> * @return com.fasterxml.jackson.databind.JsonNode</span></span><br><span class="line"><span class="comment"> * @exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> com.alibaba.fastjson.JSONObject <span class="title function_">getUrl3</span><span class="params">(String url)</span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        httpget.setURI(URI.create(url));</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> httpclient.execute(httpget,responseHandler);</span><br><span class="line">        com.alibaba.fastjson.<span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> com.alibaba.fastjson.JSONObject.parseObject(response);</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;高并发场景下的 httpClient 优化使用，参考自：&lt;a href=&quot;https://blog.csdn.net/u010285974/article/details/85696239&quot;&gt;仰望星空的尘埃&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="那些代码那些总结" scheme="https://lyblog2022.github.io/categories/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E9%82%A3%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
    
    <category term="高并发" scheme="https://lyblog2022.github.io/categories/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E9%82%A3%E4%BA%9B%E6%80%BB%E7%BB%93/%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
    
    <category term="httpClient" scheme="https://lyblog2022.github.io/tags/httpClient/"/>
    
    <category term="那些代码那些总结" scheme="https://lyblog2022.github.io/tags/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E9%82%A3%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
    
    <category term="接口调用" scheme="https://lyblog2022.github.io/tags/%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/"/>
    
    <category term="高并发" scheme="https://lyblog2022.github.io/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/"/>
    
  </entry>
  
  <entry>
    <title>nginx安装</title>
    <link href="https://lyblog2022.github.io/2022/06/20/software/nginx/"/>
    <id>https://lyblog2022.github.io/2022/06/20/software/nginx/</id>
    <published>2022-06-20T08:31:29.000Z</published>
    <updated>2022-06-21T14:41:07.003Z</updated>
    
    <content type="html"><![CDATA[<p>centos8安装nginx</p><span id="more"></span><h4 id="1、上传并安装fastdfs-nginx-module"><a href="#1、上传并安装fastdfs-nginx-module" class="headerlink" title="1、上传并安装fastdfs-nginx-module"></a>1、上传并安装fastdfs-nginx-module</h4><p>​上传  &#x2F;fastdfs-nginx-model_v1.16.tar.gz  到 &#x2F;usr&#x2F;local&#x2F;tmp 中</p><p>​进入 tmp 目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/tmp</span><br></pre></td></tr></table></figure><p>​解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxf fastdfs-nginx-module_v1.16.tar.gz</span><br></pre></td></tr></table></figure><h4 id="2、修改配置文件"><a href="#2、修改配置文件" class="headerlink" title="2、修改配置文件"></a>2、修改配置文件</h4><p>​进入解压目录中src目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure><p>​编辑config文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim config</span><br></pre></td></tr></table></figure><p>​修改配置文件中第四行，把路径中local去掉。参数是用于配置安装nginx中的FastDFS组件的时候，在什么位置查找FastDFS核心代码。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">CORE_INCS</span>=<span class="string">&quot;$CORE_INCS /usr/include/fastdfs /usr/include/fastcommon/&quot;</span></span><br></pre></td></tr></table></figure><h4 id="3、安装nginx的依赖"><a href="#3、安装nginx的依赖" class="headerlink" title="3、安装nginx的依赖"></a>3、安装nginx的依赖</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ make automake autoconf libtool pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure><h4 id="4、上传Nginx-并解压"><a href="#4、上传Nginx-并解压" class="headerlink" title="4、上传Nginx 并解压"></a>4、上传Nginx 并解压</h4><p>​上传nginx-1.16.1.tar.gz 到&#x2F;usr&#x2F;local&#x2F;tmp中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/tmp</span><br><span class="line">tar zxf nginx-1.16.1.tar.gz</span><br></pre></td></tr></table></figure><h4 id="5、修改Nginx配置"><a href="#5、修改Nginx配置" class="headerlink" title="5、修改Nginx配置"></a>5、修改Nginx配置</h4><h5 id="5-1-进入到Nginx文件夹"><a href="#5-1-进入到Nginx文件夹" class="headerlink" title="5.1 进入到Nginx文件夹"></a>5.1 进入到Nginx文件夹</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.16.1</span><br></pre></td></tr></table></figure><h5 id="5-2-创建临时目录"><a href="#5-2-创建临时目录" class="headerlink" title="5.2 创建临时目录"></a>5.2 创建临时目录</h5><p>​修改配置文件中好多位置都使用了&#x2F;var&#x2F;temp&#x2F;nginx目录，但是默认不会自动创建这个目录，需要手动创建。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/temp/nginx</span><br></pre></td></tr></table></figure><h5 id="5-3-修改配置文件参数"><a href="#5-3-修改配置文件参数" class="headerlink" title="5.3 修改配置文件参数"></a>5.3 修改配置文件参数</h5><p>内容为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">./configure \</span><br><span class="line">--prefix=/usr/local/nginx \</span><br><span class="line">--pid-path=/var/run/nginx/nginx.pid \</span><br><span class="line">--lock-path=/var/lock/nginx.lock \</span><br><span class="line">--error-log-path=/var/log/nginx/error.log \</span><br><span class="line">--http-log-path=/var/log/nginx/access.log \</span><br><span class="line">--with-http_gzip_static_module \</span><br><span class="line">--http-client-body-temp-path=/var/temp/nginx/client \</span><br><span class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \</span><br><span class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \</span><br><span class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \</span><br><span class="line">--http-scgi-temp-path=/var/temp/nginx/scgi \</span><br><span class="line">--add-module=/usr/local/tmp/fastdfs-nginx-module/src</span><br></pre></td></tr></table></figure><p>​–add-module 必须定义，此配置信息是用于指定安装Nginx时需要加载的模块，如果未指定，Nginx安装过程不会加载fastdfs-nginx-module模块，后续功能无法实现。</p><p>【报错：执行文件无权限】</p><p>先执行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x configure</span><br></pre></td></tr></table></figure><p>​再继续执行后续代码</p><h4 id="6、编译并安装"><a href="#6、编译并安装" class="headerlink" title="6、编译并安装"></a>6、编译并安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h4 id="7、配置fastdfs-nginx-module模块配置文件"><a href="#7、配置fastdfs-nginx-module模块配置文件" class="headerlink" title="7、配置fastdfs-nginx-module模块配置文件"></a>7、配置fastdfs-nginx-module模块配置文件</h4><p>​复制配置文件fastdfs-nginx-module&#x2F;src&#x2F;mod_fastdfs.conf 到 &#x2F;etc&#x2F;fdfs目录中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/tmp/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/</span><br></pre></td></tr></table></figure><h4 id="8、修改-mod-fastdfs-conf"><a href="#8、修改-mod-fastdfs-conf" class="headerlink" title="8、修改 mod_fastdfs.conf"></a>8、修改 mod_fastdfs.conf</h4><h5 id="8-1-进入到-x2F-etc-x2F-fdfs"><a href="#8-1-进入到-x2F-etc-x2F-fdfs" class="headerlink" title="8.1 进入到 &#x2F;etc&#x2F;fdfs"></a>8.1 进入到 &#x2F;etc&#x2F;fdfs</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs</span><br></pre></td></tr></table></figure><h5 id="8-2-编辑配置文件"><a href="#8-2-编辑配置文件" class="headerlink" title="8.2 编辑配置文件"></a>8.2 编辑配置文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mod_fastdfs.conf</span><br></pre></td></tr></table></figure><h5 id="8-3-文件内容修改"><a href="#8-3-文件内容修改" class="headerlink" title="8.3 文件内容修改"></a>8.3 文件内容修改</h5><p>​需要修改文件中四处内容， 这四处内容的含义：</p><p>​connect_timeout&#x3D;2 #连接超时时间，单位秒</p><p>​tracker_server&#x3D;tracker:22122 #tracker 服务结点</p><p>​url_have_group_name&#x3D;false #URL是否包含group名称</p><p>​store_path0&#x3D;&#x2F;home&#x2F;yuqing&#x2F;fastdfs #storage服务结点的存储位置，与配置storage结点一致</p><p>​修改为以下内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">connect_timeout=10</span><br><span class="line">tracker_server=192.168.93.10:22122</span><br><span class="line">url_have_group_name=true</span><br><span class="line">store_path0=/usr/local/fastdfs/storage/store</span><br></pre></td></tr></table></figure><h4 id="9、提供FastDFS需要的HTTP配置文件"><a href="#9、提供FastDFS需要的HTTP配置文件" class="headerlink" title="9、提供FastDFS需要的HTTP配置文件"></a>9、提供FastDFS需要的HTTP配置文件</h4><p>​复制FastDFS安装包中的两个配置文件(http.conf 和 mine.types) 到 &#x2F;etc&#x2F;fdfs目录中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/local/tmp/FastDFS/conf/http.conf /etc/fdfs/</span><br><span class="line">cp /usr/local/tmp/FastDFS/conf/mime.types /etc/fdfs/</span><br></pre></td></tr></table></figure><h4 id="10、创建网络访问存储服务的软连接"><a href="#10、创建网络访问存储服务的软连接" class="headerlink" title="10、创建网络访问存储服务的软连接"></a>10、创建网络访问存储服务的软连接</h4><p>​在上传文件到FastDFS后，FastDFS会返回group1&#x2F;M00&#x2F;00&#x2F;00&#x2F;xxxxxxxxx.xxx其中group1是卷名，在mod_fastdfs.conf配置文件中已配置了url_have_group_name， 以保证URL解析正确。其中的M00是FastDFS保存数据时使用的虚拟目录， 需要将这个虚拟目录定位到真实数据目录上。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/fastdfs/storage/store/data/ /usr/local/fastdfs/storage/store/data/M00</span><br></pre></td></tr></table></figure><h4 id="11、修改nginx配置文件"><a href="#11、修改nginx配置文件" class="headerlink" title="11、修改nginx配置文件"></a>11、修改nginx配置文件</h4><h5 id="11-1-进入到安装后-nginx目录"><a href="#11-1-进入到安装后-nginx目录" class="headerlink" title="11.1 进入到安装后 nginx目录"></a>11.1 进入到安装后 nginx目录</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/conf</span><br></pre></td></tr></table></figure><h5 id="11-2-编辑配置文件"><a href="#11-2-编辑配置文件" class="headerlink" title="11.2 编辑配置文件"></a>11.2 编辑配置文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure><h6 id="11-2-1-修改1"><a href="#11-2-1-修改1" class="headerlink" title="11.2.1 修改1"></a>11.2.1 修改1</h6><p>​user root； #Nginx需要访问linux文件系统，必须有文件系统的权限。User root代表nginx文件系统的权限是root用户权限。如果不开启权限，可能有404反问错误。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">user</span>  <span class="string">root;</span></span><br><span class="line"><span class="attr">worker_processes</span>  <span class="string">1;</span></span><br></pre></td></tr></table></figure><h5 id="11-2-2-修改2"><a href="#11-2-2-修改2" class="headerlink" title="11.2.2 修改2"></a>11.2.2 修改2</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server&#123;</span></span><br><span class="line">  <span class="attr">listen</span> <span class="string">8888; #storage 配置中， 有http.server_port=8888的配置信息，必须一致。配置文件是 /etc/fdfs/storaged.conf</span></span><br><span class="line">  <span class="attr">server_name</span> <span class="string">localhost;</span></span><br><span class="line">  <span class="attr">location</span> <span class="string">~/group([0-9])/M00&#123;</span></span><br><span class="line">      <span class="attr">ngx_fastdfs_module;</span></span><br><span class="line">  <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="12、启动nginx"><a href="#12、启动nginx" class="headerlink" title="12、启动nginx"></a>12、启动nginx</h4><p>进入到nginx安装目录的sbin文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin/ </span><br></pre></td></tr></table></figure><p>启动nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx</span><br></pre></td></tr></table></figure><p>关闭nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s quit</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;centos8安装nginx&lt;/p&gt;</summary>
    
    
    
    <category term="CentOs 8" scheme="https://lyblog2022.github.io/categories/CentOs-8/"/>
    
    <category term="software" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/"/>
    
    <category term="nginx" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/nginx/"/>
    
    
    <category term="software" scheme="https://lyblog2022.github.io/tags/software/"/>
    
    <category term="CentOS 8" scheme="https://lyblog2022.github.io/tags/CentOS-8/"/>
    
    <category term="nginx" scheme="https://lyblog2022.github.io/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>FastDFS实现图片上传及下载</title>
    <link href="https://lyblog2022.github.io/2022/06/20/study/FastDFS/FastDFS-file1/"/>
    <id>https://lyblog2022.github.io/2022/06/20/study/FastDFS/FastDFS-file1/</id>
    <published>2022-06-20T05:21:29.000Z</published>
    <updated>2022-06-20T08:46:20.166Z</updated>
    
    <content type="html"><![CDATA[<p>FastDFS简介及简单实现图片上传及下载</p><span id="more"></span><h3 id="1、分布式文件系统概述"><a href="#1、分布式文件系统概述" class="headerlink" title="1、分布式文件系统概述"></a>1、分布式文件系统概述</h3><h4 id="1-1-分类"><a href="#1-1-分类" class="headerlink" title="1.1 分类"></a>1.1 分类</h4><h5 id="1-1-1-通用分布式文件系统"><a href="#1-1-1-通用分布式文件系统" class="headerlink" title="1.1.1 通用分布式文件系统"></a>1.1.1 通用分布式文件系统</h5><p>​和传统的本地文件系统（如ext3、NTFS等）相对应。典型代表：lustre、MooseFS</p><ul><li>优点：标准文件系统操作方式，对开发者门槛较低</li><li>缺点：<ul><li>系统复杂性较高，需要支持若干标准的文件操作，如：目录结构、文件读写权限、文件锁等。复杂性更高</li><li>系统整体性能有所降低，因为要支持POSIX标准（表示<a href="https://baike.baidu.com/item/%E5%8F%AF%E7%A7%BB%E6%A4%8D%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%8E%A5%E5%8F%A3/12718298">可移植操作系统接口</a>（Portable Operating System Interface of UNIX），POSIX标准定义了操作系统应该为应用程序提供的接口标准）</li></ul></li></ul><h5 id="1-1-2-专用分布式文件系统"><a href="#1-1-2-专用分布式文件系统" class="headerlink" title="1.1.2 专用分布式文件系统"></a>1.1.2 专用分布式文件系统</h5><p>​基于google File System的思想，文件上传后不能修改。需要使用专有API对文件进行访问，也可称作分布式文件存储服务。典型代表：MogileFS、FastDFS、TFS。</p><ul><li>优点：<ul><li>系统复杂性较低，不需要支持若干标准的文件操作，如：目录结构、文件读写权限、文件锁等，系统比较简洁。</li><li>系统整体性能较高，因为无需支持POSIX标准，可以省去支持POSIX引入的环节，系统更加高效。</li></ul></li><li>缺点：采用专有API，对开发者门槛较高（直接封装成工具类）</li></ul><h4 id="1-2-Google-FS-体系结构"><a href="#1-2-Google-FS-体系结构" class="headerlink" title="1.2  Google FS 体系结构"></a>1.2  Google FS 体系结构</h4><ul><li>两个角色：<ul><li>名字服务器（索引服务器）</li><li>存储服务器</li></ul></li><li>架构特点<ul><li>不支持文件修改功能。</li><li>文件分块存储，需要索引服务器</li><li>一个文件可以存储多份，一个文件存储到哪些存储服务器，通常采用动态分配的方式。</li></ul></li></ul><h3 id="2、FastDFS"><a href="#2、FastDFS" class="headerlink" title="2、FastDFS"></a>2、FastDFS</h3><h4 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h4><p>​FastDFS是一个轻量级的开源分布式文件系统。2008年4月份开始启动。类似google FS的一个轻量级分布式文件系统，纯C实现，支持Linux、FreeBSD、AIX等UNIX系统。</p><p>​主要解决了大容量的文件存储和高并发访问的问题，文件存取时实现了负载均衡。实现了软件方式的磁盘阵列（Redundant Arrays of Independent Drives，RAID），可以使用廉价的IDE（Integrated Drive Electronics）硬盘进行存储。并且支持存储服务器在线扩容。支持相同内容的文件只保存一份，节约磁盘空间。</p><p>​FastDFS只能通过Client API访问，不支持POSIX访问方式。</p><p>​FastDFS特别适合大中型网站使用，用来存储资源文件（如：图片、文档、音频、视频等等）</p><h4 id="2-2-架构"><a href="#2-2-架构" class="headerlink" title="2.2 架构"></a>2.2 架构</h4><img src="/2022/06/20/study/FastDFS/FastDFS-file1/fastdfs5.png" class="" title="fastdfs5 image"><h5 id="2-2-1-角色"><a href="#2-2-1-角色" class="headerlink" title="2.2.1 角色"></a>2.2.1 角色</h5><ul><li>Client：客户端。使用java语言编写的项目属于客户端。</li><li>Tracker Server：跟踪服务器，主要做调度工作，在访问上起负载均衡的作用。在内存中记录集群中group和storage server的状态信息，是连接Client和Storage server的枢纽。</li><li>Storage Server：存储服务器，文件和文件属性（meta data）都保存到存储服务器上</li></ul><h5 id="2-2-2-架构解读"><a href="#2-2-2-架构解读" class="headerlink" title="2.2.2 架构解读"></a>2.2.2 架构解读</h5><p>​只有两个角色，tracker server和storage server，不需要存储文件索引信息。</p><p>​所有服务器都是对等的，不存在Master-Slave关系。</p><p>​存储服务器采用分组方式，同组内存储服务器上的文件完全相同（RAID 1）。</p><p>​不同组的storage server之间不会相互通信。</p><p>​由storage server主动向tracker server报告状态信息，tracker server之间不会相互通信。</p><h3 id="1、文件上传"><a href="#1、文件上传" class="headerlink" title="1、文件上传"></a>1、文件上传</h3><h4 id="1-1-时序图"><a href="#1-1-时序图" class="headerlink" title="1.1 时序图"></a>1.1 时序图</h4><img src="/2022/06/20/study/FastDFS/FastDFS-file1/fastdfs1.png" class="" title="fastdfs1 image"><h4 id="1-2-流程说明"><a href="#1-2-流程说明" class="headerlink" title="1.2 流程说明"></a>1.2 流程说明</h4><ol><li>客户端访问Tracker</li><li>Tracker 返回Storage的ip和端口</li><li>客户端直接访问Storage，把文件内容和元数据发送过去。</li><li>Storage返回文件存储id。包含了组名和文件名</li></ol><img src="/2022/06/20/study/FastDFS/FastDFS-file1/fastdfs2.png" class="" title="fastdfs2 image"><h4 id="1-3-Fastdfs-java-client"><a href="#1-3-Fastdfs-java-client" class="headerlink" title="1.3 Fastdfs-java-client"></a>1.3 Fastdfs-java-client</h4><h5 id="1-3-1-添加依赖"><a href="#1-3-1-添加依赖" class="headerlink" title="1.3.1 添加依赖"></a>1.3.1 添加依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.bestwu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastdfs-client-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.27<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span> `     </span><br></pre></td></tr></table></figure><h5 id="1-3-2-编写配置文件"><a href="#1-3-2-编写配置文件" class="headerlink" title="1.3.2 编写配置文件"></a>1.3.2 编写配置文件</h5><p>​文件名：fdfs_client.conf</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">connect_timeout</span> = <span class="string">10</span></span><br><span class="line"><span class="attr">network_timeout</span> = <span class="string">30</span></span><br><span class="line"><span class="attr">charset</span> = <span class="string">UTF-8</span></span><br><span class="line"><span class="attr">http.tracker_http_port</span> = <span class="string">8080</span></span><br><span class="line"><span class="attr">tracker_server</span> = <span class="string">192.168.213.133:22122</span></span><br></pre></td></tr></table></figure><h5 id="1-3-3-导入工具类"><a href="#1-3-3-导入工具类" class="headerlink" title="1.3.3 导入工具类"></a>1.3.3 导入工具类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.csource.common.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.ClientGlobal;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.StorageClient;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.StorageClient1;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.StorageServer;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.TrackerClient;</span><br><span class="line"><span class="keyword">import</span> org.csource.fastdfs.TrackerServer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * FastDFSClient</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> com.util</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/19 19:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastDFSClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONF_FILENAME</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader().getResource(<span class="string">&quot;&quot;</span>).getPath() + <span class="string">&quot;fdfs_client.conf&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">StorageClient</span> <span class="variable">storageClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只加载一次.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ClientGlobal.init(CONF_FILENAME);</span><br><span class="line">            <span class="type">TrackerClient</span> <span class="variable">trackerClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TrackerClient</span>(ClientGlobal.g_tracker_group);</span><br><span class="line">            <span class="type">TrackerServer</span> <span class="variable">trackerServer</span> <span class="operator">=</span> trackerClient.getConnection();</span><br><span class="line">            <span class="type">StorageServer</span> <span class="variable">storageServer</span> <span class="operator">=</span> trackerClient.getStoreStorage(trackerServer);</span><br><span class="line">            storageClient = <span class="keyword">new</span> <span class="title class_">StorageClient</span>(trackerServer, storageServer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream</span></span><br><span class="line"><span class="comment">     *    上传的文件输入流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     *    上传的文件原始名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] uploadFile(InputStream inputStream, String fileName) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 文件的元数据</span></span><br><span class="line">            NameValuePair[] meta_list = <span class="keyword">new</span> <span class="title class_">NameValuePair</span>[<span class="number">2</span>];</span><br><span class="line">            <span class="comment">// 第一组元数据，文件的原始名称</span></span><br><span class="line">            meta_list[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">NameValuePair</span>(<span class="string">&quot;file name&quot;</span>, fileName);</span><br><span class="line">            <span class="comment">// 第二组元数据</span></span><br><span class="line">            meta_list[<span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">NameValuePair</span>(<span class="string">&quot;file length&quot;</span>, inputStream.available()+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">// 准备字节数组</span></span><br><span class="line">            <span class="type">byte</span>[] file_buff = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 查看文件的长度</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> inputStream.available();</span><br><span class="line">                <span class="comment">// 创建对应长度的字节数组</span></span><br><span class="line">                file_buff = <span class="keyword">new</span> <span class="title class_">byte</span>[len];</span><br><span class="line">                <span class="comment">// 将输入流中的字节内容，读到字节数组中。</span></span><br><span class="line">                inputStream.read(file_buff);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 上传文件。参数含义：要上传的文件的内容（使用字节数组传递），上传的文件的类型（扩展名），元数据</span></span><br><span class="line">            String[] fileids = storageClient.upload_file(file_buff, getFileExt(fileName), meta_list);</span><br><span class="line">            <span class="keyword">return</span> fileids;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     *            文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     *            文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回Null则为失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] uploadFile(File file, String fileName) &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            NameValuePair[] meta_list = <span class="literal">null</span>; <span class="comment">// new NameValuePair[0];</span></span><br><span class="line">            fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">            <span class="type">byte</span>[] file_buff = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> fis.available();</span><br><span class="line">                file_buff = <span class="keyword">new</span> <span class="title class_">byte</span>[len];</span><br><span class="line">                fis.read(file_buff);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String[] fileids = storageClient.upload_file(file_buff, getFileExt(fileName), meta_list);</span><br><span class="line">            <span class="keyword">return</span> fileids;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据组名和远程文件名来删除一个文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupName</span></span><br><span class="line"><span class="comment">     *            例如 &quot;group1&quot; 如果不指定该值，默认为group1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> remoteFileName</span></span><br><span class="line"><span class="comment">     *            例如&quot;M00/00/00/wKgxgk5HbLvfP86RAAAAChd9X1Y736.jpg&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 0为成功，非0为失败，具体为错误代码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">deleteFile</span><span class="params">(String groupName, String remoteFileName)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> storageClient.delete_file(groupName == <span class="literal">null</span> ? <span class="string">&quot;group1&quot;</span> : groupName, remoteFileName);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改一个已经存在的文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldGroupName</span></span><br><span class="line"><span class="comment">     *            旧的组名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> oldFileName</span></span><br><span class="line"><span class="comment">     *            旧的文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     *            新文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     *            新文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回空则为失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] modifyFile(String oldGroupName, String oldFileName, File file, String fileName) &#123;</span><br><span class="line">        String[] fileids = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 先上传</span></span><br><span class="line">            fileids = uploadFile(file, fileName);</span><br><span class="line">            <span class="keyword">if</span> (fileids == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 再删除</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">delResult</span> <span class="operator">=</span> deleteFile(oldGroupName, oldFileName);</span><br><span class="line">            <span class="keyword">if</span> (delResult != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileids;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> groupName 卷名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> remoteFileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个流</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> InputStream <span class="title function_">downloadFile</span><span class="params">(String groupName, String remoteFileName)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = storageClient.download_file(groupName, remoteFileName);</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes);</span><br><span class="line">            <span class="keyword">return</span> inputStream;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> NameValuePair[] getMetaDate(String groupName, String remoteFileName)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            NameValuePair[] nvp = storageClient.get_metadata(groupName, remoteFileName);</span><br><span class="line">            <span class="keyword">return</span> nvp;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件后缀名（不带点）.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如：&quot;jpg&quot; or &quot;&quot;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getFileExt</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(fileName) || !fileName.contains(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>); <span class="comment">// 不带最后的点</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="1-3-4编写测试代码"><a href="#1-3-4编写测试代码" class="headerlink" title="1.3.4编写测试代码"></a>1.3.4编写测试代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:\\note\\source\\_posts\\software\\FastDFS\\fastdfs.png&quot;</span>);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> UUID.randomUUID().toString()+<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">        String[] result = FastDFSClient.uploadFile(is, fileName);</span><br><span class="line">        System.out.println(Arrays.toString(result));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2022/06/20/study/FastDFS/FastDFS-file1/fastdfs3.png" class="" title="fastdfs3 image"><h3 id="2、文件下载"><a href="#2、文件下载" class="headerlink" title="2、文件下载"></a>2、文件下载</h3><h4 id="2-1-时序图"><a href="#2-1-时序图" class="headerlink" title="2.1 时序图"></a>2.1 时序图</h4><img src="/2022/06/20/study/FastDFS/FastDFS-file1/fastdfs3.png" class="" title="fastdfs3 image"><h4 id="2-2-下载说明"><a href="#2-2-下载说明" class="headerlink" title="2.2 下载说明"></a>2.2 下载说明</h4><ol><li><p>client询问tracker下载文件的storage，参数为文件标识（组名和文件名）；</p></li><li><p>tracker返回一台可用的storage；</p></li><li><p>client直接和storage通讯完成文件下载。</p></li></ol><h4 id="2-3-测试代码"><a href="#2-3-测试代码" class="headerlink" title="2.3 测试代码"></a>2.3 测试代码</h4><p>直接使用工具方法完成下载。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.down;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.util.FastDFSClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Download</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> com.down</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/6/19 20:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Download</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> FastDFSClient.downloadFile(<span class="string">&quot;group1&quot;</span>, <span class="string">&quot;M00/00/00/wKjVhWKvD_iAZ0rRAACDGmk1a_U227.png&quot;</span>);</span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;E:/jqk.png&quot;</span>));</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">while</span>((index = is.read())!=-<span class="number">1</span>)&#123;</span><br><span class="line">                os.write(index);</span><br><span class="line">            &#125;</span><br><span class="line">            os.flush();</span><br><span class="line">            os.close();</span><br><span class="line">            is.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;FastDFS简介及简单实现图片上传及下载&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="FastDFS" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/FastDFS/"/>
    
    
    <category term="FastDFS" scheme="https://lyblog2022.github.io/tags/FastDFS/"/>
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>FastDFS安装</title>
    <link href="https://lyblog2022.github.io/2022/06/19/software/FastDFS/"/>
    <id>https://lyblog2022.github.io/2022/06/19/software/FastDFS/</id>
    <published>2022-06-19T06:02:05.000Z</published>
    <updated>2022-06-20T05:20:00.045Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS8安装FastDFS</p><span id="more"></span><h4 id="1、安装FastDFS依赖"><a href="#1、安装FastDFS依赖" class="headerlink" title="1、安装FastDFS依赖"></a>1、安装FastDFS依赖</h4><p> FastDFS是C语言开发的应用。安装必须使用 make , cmake 和 gcc编译器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y make cmake gcc gcc-c++</span><br></pre></td></tr></table></figure><h4 id="2、上传并解压libfastcommon-master"><a href="#2、上传并解压libfastcommon-master" class="headerlink" title="2、上传并解压libfastcommon-master"></a>2、上传并解压libfastcommon-master</h4><p>上传libfastcommon-master 到 &#x2F;usr&#x2F;local&#x2F;tmp下。 libfastcommon是从FastDFS和FastDHT中提取出来的公共C函数库</p><p>解压 libfastcommon-master.zip 由于是zip文件所以要使用 unzip命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/tmp</span><br><span class="line">unzip libfastcommon-master.zip</span><br></pre></td></tr></table></figure><h4 id="3、编译并安装"><a href="#3、编译并安装" class="headerlink" title="3、编译并安装"></a>3、编译并安装</h4><p>libfastcommon没有提供make命令安装文件。使用的是shell脚本执行编译和安装。shell脚本为 make.sh</p><p>进入解压后的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd libfastcommon-master</span><br></pre></td></tr></table></figure><p>编译</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh install</span><br></pre></td></tr></table></figure><p>有固定的默认安装位置。在&#x2F;usr&#x2F;lib64 和  &#x2F;usr&#x2F;include&#x2F;fastcommon两个目录中</p><h4 id="4、创建软连接"><a href="#4、创建软连接" class="headerlink" title="4、创建软连接"></a>4、创建软连接</h4><p> 因为FastDFS 主程序设置的lib目录是 &#x2F;usr&#x2F;local&#x2F;lib， 所以需要创建软连接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /user/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</span><br><span class="line">ln -s /usr/local/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</span><br></pre></td></tr></table></figure><h4 id="5、上传并解压FastDFS主程序"><a href="#5、上传并解压FastDFS主程序" class="headerlink" title="5、上传并解压FastDFS主程序"></a>5、上传并解压FastDFS主程序</h4><p>上传 FastDFS_v5.08.tar.gz 到 &#x2F;usr&#x2F;local&#x2F;tmp下后解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/tmp</span><br><span class="line">tar zxf FastDFS_v5.08.tar.gz</span><br></pre></td></tr></table></figure><h4 id="6、编译并安装FastDFS"><a href="#6、编译并安装FastDFS" class="headerlink" title="6、编译并安装FastDFS"></a>6、编译并安装FastDFS</h4><p>进入到解压后的FastDFS文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd FastDFS</span><br></pre></td></tr></table></figure><p>编译</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh</span><br></pre></td></tr></table></figure><p>安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh install</span><br></pre></td></tr></table></figure><p>​安装后 FastDFS主程序所在的位置是</p><p>​&#x2F;usr&#x2F;bin  可执行文件所在的位置</p><p>​&#x2F;etc&#x2F;fdfs  配置文件所在的位置</p><p>​&#x2F;usr&#x2F;bin  主程序代码所在位置</p><p>​&#x2F;usr&#x2F;include&#x2F;fastdfs 包含一些插件组所在的位置</p><h4 id="7、配置tracker"><a href="#7、配置tracker" class="headerlink" title="7、配置tracker"></a>7、配置tracker</h4><h5 id="7-1-复制配置文件"><a href="#7-1-复制配置文件" class="headerlink" title="7.1 复制配置文件"></a>7.1 复制配置文件</h5><p>进入到 &#x2F;etc&#x2F;fdfs 中 ， 把tracker配置文件复制一份</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs</span><br><span class="line">cp tracker.conf.sample tracker.conf</span><br></pre></td></tr></table></figure><h5 id="7-2-创建数据目录"><a href="#7-2-创建数据目录" class="headerlink" title="7.2 创建数据目录"></a>7.2 创建数据目录</h5><p>创建放置 tracker数据的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/fastdfs/tracker</span><br></pre></td></tr></table></figure><h5 id="7-3-修改配置文件"><a href="#7-3-修改配置文件" class="headerlink" title="7.3 修改配置文件"></a>7.3 修改配置文件</h5><p>修改 tracker.conf 设置 tracker 内容存储目录</p><p>base_path&#x3D;&#x2F;usr&#x2F;local&#x2F;fastdfs&#x2F;tracker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim tracker.conf</span><br></pre></td></tr></table></figure><h5 id="7-4-启动服务"><a href="#7-4-启动服务" class="headerlink" title="7.4 启动服务"></a>7.4 启动服务</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd start</span><br></pre></td></tr></table></figure><p>启动成功后， 配置文件中 base_path 指向的目录出现 FastDFS服务相关数据目录(data目录， logs 目录)</p><h5 id="7-5-查看服务运行状态"><a href="#7-5-查看服务运行状态" class="headerlink" title="7.5 查看服务运行状态"></a>7.5 查看服务运行状态</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd status</span><br></pre></td></tr></table></figure><p>如果显示 is running 表示正常运行。</p><h4 id="8、配置storage"><a href="#8、配置storage" class="headerlink" title="8、配置storage"></a>8、配置storage</h4><p> storage可以和tracker不在同一台服务器上。示例中把storage和tracker安装在同一台服务器上了。</p><h5 id="8-1-复制配置文件"><a href="#8-1-复制配置文件" class="headerlink" title="8.1 复制配置文件"></a>8.1 复制配置文件</h5><p>进入到 &#x2F;etc&#x2F;fdfs, 把 storage 配置文件复制一份</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs</span><br><span class="line">cp storage.conf.sample storage.conf</span><br></pre></td></tr></table></figure><h5 id="8-2-创建目录"><a href="#8-2-创建目录" class="headerlink" title="8.2 创建目录"></a>8.2 创建目录</h5><p>创建两个目录， 把base用于存储基础数据和日志，store用于存储上传数据。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/fastdfs/storage/base</span><br><span class="line">mkdir -p /usr/local/fastdfs/storage/store</span><br></pre></td></tr></table></figure><h5 id="8-3-修改配置文件"><a href="#8-3-修改配置文件" class="headerlink" title="8.3 修改配置文件"></a>8.3 修改配置文件</h5><p>​storage.conf配置文件用于描述存储服务的行为，需要进行下述修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure><p>配置内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_path=/usr/local/fastdfs/storage/base</span><br><span class="line">store_path0=/usr/local/fastdfs/storage/store</span><br><span class="line">tracker_server=tracker的服务IP：22122</span><br></pre></td></tr></table></figure><p>​base_path - 基础路径。用于保存storage server 基础数据内容和日志内容的目录。</p><p>​store_path0 - 存储路径。是用于保存FastDFS中存储文件的目录，就是要创建256*256个子目录的位置。</p><p>​base_path 和 store_path0 可以使用同一个目录。</p><p>​tracker_server - 跟踪服务器位置。就是跟踪服务器的IP和端口。</p><p>​启动服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_storaged start</span><br></pre></td></tr></table></figure><p>​启动成功后，配置文件中base_path 指向的目录中出现FastDFS服务相关数据目录（data目录、logs目录）配置文件中的store_path0指向的目录中同样出现FastDFS存储相关数据录（data目录）。其中$store_path0&#x2F;data&#x2F;目录中默认创建若干子孙目录（两级目录层级总计256*256个目录），是用于存储具体文件数据的。</p><p>​Storage 服务器启动比较慢，因为第一次启动的时候，需要创建256*256个目录。</p><p>​查看启动状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_storaged status</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;CentOS8安装FastDFS&lt;/p&gt;</summary>
    
    
    
    <category term="CentOs 8" scheme="https://lyblog2022.github.io/categories/CentOs-8/"/>
    
    <category term="software" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/"/>
    
    <category term="FastDFS" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/FastDFS/"/>
    
    
    <category term="software" scheme="https://lyblog2022.github.io/tags/software/"/>
    
    <category term="FastDFS" scheme="https://lyblog2022.github.io/tags/FastDFS/"/>
    
    <category term="CentOS 8" scheme="https://lyblog2022.github.io/tags/CentOS-8/"/>
    
  </entry>
  
  <entry>
    <title>dubbo项目</title>
    <link href="https://lyblog2022.github.io/2022/06/12/study/dubbo/dubbo%E9%A1%B9%E7%9B%AE/"/>
    <id>https://lyblog2022.github.io/2022/06/12/study/dubbo/dubbo%E9%A1%B9%E7%9B%AE/</id>
    <published>2022-06-12T02:28:02.000Z</published>
    <updated>2022-06-12T14:20:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>dubbo简单的小项目</p><span id="more"></span><h3 id="1、原型"><a href="#1、原型" class="headerlink" title="1、原型"></a>1、原型</h3><h4 id="1-1-部门原型"><a href="#1-1-部门原型" class="headerlink" title="1.1 部门原型"></a>1.1 部门原型</h4><p>​显示全部部门信息</p><img src="/2022/06/12/study/dubbo/dubbo%E9%A1%B9%E7%9B%AE/Dubbo-4.png" class="" title="Dubbo-4 image"><h4 id="1-2-员工新增"><a href="#1-2-员工新增" class="headerlink" title="1.2 员工新增"></a>1.2 员工新增</h4><img src="/2022/06/12/study/dubbo/dubbo%E9%A1%B9%E7%9B%AE/Dubbo-5.png" class="" title="Dubbo-5 image"><h4 id="1-3-查看部门员工"><a href="#1-3-查看部门员工" class="headerlink" title="1.3 查看部门员工"></a>1.3 查看部门员工</h4><img src="/2022/06/12/study/dubbo/dubbo%E9%A1%B9%E7%9B%AE/Dubbo-6.png" class="" title="Dubbo-6 image"><h3 id="2、按照分布式架构进行设计项目"><a href="#2、按照分布式架构进行设计项目" class="headerlink" title="2、按照分布式架构进行设计项目"></a>2、按照分布式架构进行设计项目</h3><p>​设定员工管理和部门管理不在同一个模块中，需要有一个员工管理项目和一个部门管理项目。</p><p>​为了方便，不去每个项目使用一个窗口，而是使用聚合项目。</p><img src="/2022/06/12/study/dubbo/dubbo%E9%A1%B9%E7%9B%AE/Dubbo-7.png" class="" title="Dubbo-7 image"><h3 id="3、创建数据库"><a href="#3、创建数据库" class="headerlink" title="3、创建数据库"></a>3、创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="keyword">default</span>,<span class="string">&#x27;开发部&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="keyword">default</span>,<span class="string">&#x27;产品部&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">id <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">photo <span class="type">varchar</span>(<span class="number">200</span>),</span><br><span class="line">did <span class="type">int</span>(<span class="number">11</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> fk_emp_dept <span class="keyword">FOREIGN</span> key (did) <span class="keyword">REFERENCES</span> dept(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;dubbo简单的小项目&lt;/p&gt;</summary>
    
    
    
    <category term="项目" scheme="https://lyblog2022.github.io/categories/%E9%A1%B9%E7%9B%AE/"/>
    
    <category term="dubbo" scheme="https://lyblog2022.github.io/categories/%E9%A1%B9%E7%9B%AE/dubbo/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="dubbo" scheme="https://lyblog2022.github.io/tags/dubbo/"/>
    
    <category term="项目" scheme="https://lyblog2022.github.io/tags/%E9%A1%B9%E7%9B%AE/"/>
    
  </entry>
  
  <entry>
    <title>dubbo学习</title>
    <link href="https://lyblog2022.github.io/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/"/>
    <id>https://lyblog2022.github.io/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-06-11T11:51:20.000Z</published>
    <updated>2022-06-11T14:11:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>dubbo基础学习、架构、支持的协议及注册中心学习，一个简单的Demo项目及负载均衡的简单配置</p><span id="more"></span><h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><p>​Apache Dubbo 是一个高可用的，基于Java的开源RPC框架。</p><p>​Dubbo框架不仅仅是具备RPC访问功能，还包含服务治理功能。</p><h4 id="1-1-发展历程"><a href="#1-1-发展历程" class="headerlink" title="1.1 发展历程"></a>1.1 发展历程</h4><p>​Dubbo是最开始是阿里巴巴内部使用的RPC框架。</p><p>​2011年对外提供。</p><p>​2012年停止更新。</p><p>​2017年开始继续更新。</p><p>​2019年捐献给Apache，由Apache维护2.7以上版本。</p><h4 id="1-2-架构"><a href="#1-2-架构" class="headerlink" title="1.2 架构"></a>1.2 架构</h4><img src="/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/Dubbo-2.png" class="" title="Dubbo-2 image"><ul><li>线条：虚线表示异步，实线表示同步。异步不阻塞线程性能高，同步阻塞线程必须等待响应结果才能继续执行，相对性能低。</li><li>provider：提供者。编写持久层和事务代码。</li><li>container：容器（Spring容器），Dubbo完全基于Spring实现的。</li><li>register：注册中心。放置所有Provider对外提供的信息。包含Provider的IP，访问端口，访问遵守的协议，对外提供的接口，接口中有哪些方法等相关信息。</li><li>consumer：消费者（RPC调用者，SOA调用服务的项目）开发中也是一个项目，编写service和controller（还可以报页面等）。调用XXXXServiceImpl中的方法。</li><li>monitor：监控中心。监控Provider的压力情况等。每隔2分钟Consumer和Provider会把调用次数发送给Monitor，由Monitor进行统计。</li><li>执行流程：<ol><li>start：启动Spring容器时会把Provider启动。 </li><li>register：把Provider相关信息注册到Registry里</li><li>subscribe：Consumer从Registry中订阅Provider的信息</li><li>notify：通知给Consumer</li><li>invoke：Consumer根据Registry通知的信息进行调用Provider中方法。</li><li>count:Consumer和Provider把调用次数信息异步发送给Monitor进行统计。</li></ol></li></ul><h3 id="2、支持的协议"><a href="#2、支持的协议" class="headerlink" title="2、支持的协议"></a>2、支持的协议</h3><h4 id="2-1-Dubbo协议（官方推荐）"><a href="#2-1-Dubbo协议（官方推荐）" class="headerlink" title="2.1 Dubbo协议（官方推荐）"></a>2.1 Dubbo协议（官方推荐）</h4><p>​优点：</p><p>​采用NIO复用单一长连接，并使用线程池并发处理请求，减少握手和加大并发效率，性能较好（推荐使用）</p><p>​缺点：</p><p>​大文件上传时,可能出现问题(不使用Dubbo文件上传)</p><h4 id="2-2-RMI（Remote-Method-Invocation）协议"><a href="#2-2-RMI（Remote-Method-Invocation）协议" class="headerlink" title="2.2 RMI（Remote Method Invocation）协议"></a>2.2 RMI（Remote Method Invocation）协议</h4><p>​优点:</p><p>​JDK自带的能力。</p><p>​缺点:</p><p>​偶尔连接失败</p><h4 id="2-3-Hessian协议"><a href="#2-3-Hessian协议" class="headerlink" title="2.3 Hessian协议"></a>2.3 Hessian协议</h4><p>​优点:</p><p>​可与原生Hessian互操作，基于HTTP协议</p><p>​缺点:</p><p>​需hessian.jar支持，http短连接的开销大</p><h3 id="3、支持的注册中心"><a href="#3、支持的注册中心" class="headerlink" title="3、支持的注册中心"></a>3、支持的注册中心</h3><h4 id="3-1-Zookeeper（官方推荐）"><a href="#3-1-Zookeeper（官方推荐）" class="headerlink" title="3.1 Zookeeper（官方推荐）"></a>3.1 Zookeeper（官方推荐）</h4><p>​优点:</p><p>​支持分布式.很多周边产品</p><p>​缺点: </p><p>​受限于Zookeeper软件的稳定性.Zookeeper专门分布式辅助软件,稳定较优</p><h4 id="3-2-Multicast"><a href="#3-2-Multicast" class="headerlink" title="3.2 Multicast"></a>3.2 Multicast</h4><p>​优点:</p><p>​去中心化,不需要单独安装软件.</p><p>​缺点:</p><p>​Provider和Consumer和Registry不能跨机房(路由)</p><h4 id="3-3-Redis"><a href="#3-3-Redis" class="headerlink" title="3.3 Redis"></a>3.3 Redis</h4><p>​优点:</p><p>​支持集群,性能高</p><p>​缺点:</p><p>​要求服务器时间同步.否则可能出现集群失败问题.</p><h4 id="3-4-Simple"><a href="#3-4-Simple" class="headerlink" title="3.4 Simple"></a>3.4 Simple</h4><p>​优点: </p><p>​标准RPC服务.没有兼容问题</p><p>​ 缺点: </p><p>​不支持集群.</p><h3 id="4、项目Demo"><a href="#4、项目Demo" class="headerlink" title="4、项目Demo"></a>4、项目Demo</h3><p>​新建父项目Dubbo</p><p>​pom：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-1-创建子项目api"><a href="#4-1-创建子项目api" class="headerlink" title="4.1 创建子项目api"></a>4.1 创建子项目api</h4><p>创建类DemoService（dubbo）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dubbo.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 11 - 20:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.dubbo.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">(String param)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2-创建provider项目"><a href="#4-2-创建provider项目" class="headerlink" title="4.2 创建provider项目"></a>4.2 创建provider项目</h4><p>1、添加pom依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、创建实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dubbo.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.dubbo.service.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 11 - 21:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.dubbo.service.Impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">(String param)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;demo 已执行&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> param+<span class="string">&quot;xxxxxxxxxxx&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、创建application.yml配置</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-provider</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://192.168.253.132:2181</span></span><br></pre></td></tr></table></figure><h4 id="4-3-创建consume子项目"><a href="#4-3-创建consume子项目" class="headerlink" title="4.3 创建consume子项目"></a>4.3 创建consume子项目</h4><p>1、添加pom依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、创建Service接口(springboot)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 11 - 21:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、创建Service接口实现类（springboot）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.service.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 11 - 21:07</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.service.Impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> com.dubbo.service.DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.demo(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、创建controller控制了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.service.DemoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: liuyong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 11 - 21:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/demo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> demoService.demo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5、添加配置文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-consumer</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://192.168.253.132:2181</span></span><br></pre></td></tr></table></figure><h4 id="4-4-运行项目"><a href="#4-4-运行项目" class="headerlink" title="4.4 运行项目"></a>4.4 运行项目</h4><p>运行顺序：先启动provider，再启动consume</p><img src="/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/dubbo3.png" class="" title="dubbo3 image"><p>控制台运行结果：</p><img src="/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/dubbo4.png" class="" title="dubbo4 image"><p>dubbo运行结果</p><img src="/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/dubbo6.png" class="" title="dubbo6 image"><h4 id="4-5-运行异常"><a href="#4-5-运行异常" class="headerlink" title="4.5 运行异常"></a>4.5 运行异常</h4><p>启动provider和consume报错</p><img src="/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/dubbo5.png" class="" title="dubbo5 image"><p>解决方案：</p><p>添加一下依赖即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-x-discovery --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-x-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5、搭建admin管理界面"><a href="#5、搭建admin管理界面" class="headerlink" title="5、搭建admin管理界面"></a>5、搭建admin管理界面</h3><p>使用jar文件 dubbo-admin-0.2.0.jar</p><p>将jar文件内配置文件的地址改为本地的zookeeper地址</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># centers in dubbo2.7</span></span><br><span class="line"><span class="attr">admin.registry.address</span>=<span class="string">zookeeper://192.168.253.132:2181</span></span><br><span class="line"><span class="attr">admin.config-center</span>=<span class="string">zookeeper://192.168.253.132:2181</span></span><br><span class="line"><span class="attr">admin.metadata-report.address</span>=<span class="string">zookeeper://192.168.253.132:2181</span></span><br></pre></td></tr></table></figure><p>使用 java -jar命令运行jar文件</p><img src="/2022/06/11/study/dubbo/dubbo%E5%AD%A6%E4%B9%A0/dubbo7.png" class="" title="dubbo7 image"><h3 id="6、负载均衡"><a href="#6、负载均衡" class="headerlink" title="6、负载均衡"></a>6、负载均衡</h3><ul><li>集群：一个内容，部署多次，形成的整体称为集群。集群中每个个体应该部署到不同的服务器上。</li><li>伪集群：集群中内容部署到同一台服务器上，通过不同端口区分不同个体。</li><li>负载均衡是在集群前提下，当访问整个集群时，集群中每个节点被访问次数或频率的规则。</li><li>Dubbo 内置了四个负载均衡策略。默认为Random</li></ul><h4 id="6-1-内置策略"><a href="#6-1-内置策略" class="headerlink" title="6.1 内置策略"></a>6.1 内置策略</h4><ul><li>Random：随机。随机访问集群中节点。访问概率和权重有关。</li><li>RoundRobin：轮询。访问频率和权重有关。<ul><li>权重（weight）：占有比例。集群中每个项目部署的服务器的性能可能是不同，性能好的服务器权重应该高一些。</li></ul></li><li>LeastActive：活跃数相同的随机，不同的活跃数高的放前面。</li><li>ConsistentHash：一致性Hash。相同参数请求总是发到一个提供者。</li></ul><h4 id="6-2-设置负载均衡"><a href="#6-2-设置负载均衡" class="headerlink" title="6.2 设置负载均衡"></a>6.2 设置负载均衡</h4><h5 id="6-2-1-Reference"><a href="#6-2-1-Reference" class="headerlink" title="6.2.1 @Reference"></a>6.2.1 @Reference</h5><p>​调用的服务采用的负载均衡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference(loadbalance = &quot;roundrobin&quot;)</span></span><br><span class="line"><span class="keyword">private</span> DemoService demoService;</span><br></pre></td></tr></table></figure><h5 id="6-2-2-Service"><a href="#6-2-2-Service" class="headerlink" title="6.2.2 @Service"></a>6.2.2 @Service</h5><p>​当前服务采用的负载均衡算法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(loadbalance = &quot;random&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br></pre></td></tr></table></figure><p>​设置权重</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(weight = 4)</span></span><br></pre></td></tr></table></figure><h5 id="6-2-3-配置文件"><a href="#6-2-3-配置文件" class="headerlink" title="6.2.3 配置文件"></a>6.2.3 配置文件</h5><p>​全局设置所有provider和consumer的负载均衡效果</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-provider</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://192.168.32.128:2181</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">20884</span></span><br><span class="line">  <span class="attr">provider:</span></span><br><span class="line">    <span class="attr">loadbalance:</span> <span class="string">random</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">loadbalance:</span> <span class="string">random</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;dubbo基础学习、架构、支持的协议及注册中心学习，一个简单的Demo项目及负载均衡的简单配置&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="dubbo" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/dubbo/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="dubbo" scheme="https://lyblog2022.github.io/tags/dubbo/"/>
    
  </entry>
  
  <entry>
    <title>手写rpc框架</title>
    <link href="https://lyblog2022.github.io/2022/06/09/study/%E6%89%8B%E5%86%99rpc%E6%A1%86%E6%9E%B6/"/>
    <id>https://lyblog2022.github.io/2022/06/09/study/%E6%89%8B%E5%86%99rpc%E6%A1%86%E6%9E%B6/</id>
    <published>2022-06-09T05:01:35.000Z</published>
    <updated>2022-06-09T05:29:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用Zookeeper作为注册中心，RMI作为连接技术，手写RPC框架。</p><span id="more"></span><h4 id="1、创建RPCClient项目"><a href="#1、创建RPCClient项目" class="headerlink" title="1、创建RPCClient项目"></a>1、创建RPCClient项目</h4><p>创建父项目RPCClient</p><p>包含三个子项目</p><p>pojo: service中需要的实体类</p><p>service：包含被serviceimpl和consumer依赖的接口。</p><p>serviceimpl:provider提供的服务内容</p><p>consumer：消费者，调用服务内容。</p><h4 id="2、pojo项目"><a href="#2、pojo项目" class="headerlink" title="2、pojo项目"></a>2、pojo项目</h4><p>在父项目下新建子项目pojo</p><p>该子项目包括一个文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 08 - 21:04</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Integer id, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3、service项目"><a href="#3、service项目" class="headerlink" title="3、service项目"></a>3、service项目</h4><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pojo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>新建MyService接口，继承Remote类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 08 - 21:06</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyService</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4、provider项目"><a href="#4、provider项目" class="headerlink" title="4、provider项目"></a>4、provider项目</h4><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>新建ProviderRun类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.service.Impl.MyServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.service.MyService;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 08 - 21:15</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderRun</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MyService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>();</span><br><span class="line">            LocateRegistry.createRegistry(<span class="number">8989</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;rmi://localhost:8989/myService&quot;</span>;</span><br><span class="line">            Naming.bind(url, service);</span><br><span class="line">            System.out.println(<span class="string">&quot;MRI服务启动成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//创建zookeeper并发布信息</span></span><br><span class="line">            <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(<span class="string">&quot;192.168.253.132:2181&quot;</span>, <span class="number">10000</span>, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;获取链接&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"><span class="comment">//运行前确保/rpc目录存在</span></span><br><span class="line">            zooKeeper.create(<span class="string">&quot;/rpc/provider&quot;</span>,url.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">            System.out.println(<span class="string">&quot;注册成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行项目，打开zookeeper，查看是否写入到&#x2F;rpc&#x2F;provider</p><img src="/2022/06/09/study/%E6%89%8B%E5%86%99rpc%E6%A1%86%E6%9E%B6/rpc1.png" class="" title="rpc1 image"><h4 id="5、consume项目"><a href="#5、consume项目" class="headerlink" title="5、consume项目"></a>5、consume项目</h4><p>添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建service接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.consumer.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 08 - 21:36</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.consumer.service</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PageService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建其实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.consumer.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.User;</span><br><span class="line"><span class="keyword">import</span> com.consumer.service.PageService;</span><br><span class="line"><span class="keyword">import</span> com.service.MyService;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Naming;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 08 - 21:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.consumer.service.Impl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PageService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(<span class="string">&quot;192.168.253.132:2181&quot;</span>, <span class="number">10000</span>, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;链接成功&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="type">byte</span>[] bytes = zooKeeper.getData(<span class="string">&quot;/rpc/provider&quot;</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">            <span class="type">MyService</span> <span class="variable">myService</span> <span class="operator">=</span> (MyService) Naming.lookup(<span class="keyword">new</span> <span class="title class_">String</span>(bytes));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> myService.findAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建控制器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.consumer.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.User;</span><br><span class="line"><span class="keyword">import</span> com.consumer.service.PageService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2022 - 06 - 08 - 22:19</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: com.consumer.controller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PageService pageService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/show&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> pageService.show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>启动springboot项目，输入localhost:8080&#x2F;show</p><img src="/2022/06/09/study/%E6%89%8B%E5%86%99rpc%E6%A1%86%E6%9E%B6/rpc3.png" class="" title="rpc3 image">]]></content>
    
    
    <summary type="html">&lt;p&gt;使用Zookeeper作为注册中心，RMI作为连接技术，手写RPC框架。&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="RPC" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/RPC/"/>
    
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/tags/zookeeper/"/>
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="RPC" scheme="https://lyblog2022.github.io/tags/RPC/"/>
    
  </entry>
  
  <entry>
    <title>zookeeper使用</title>
    <link href="https://lyblog2022.github.io/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/"/>
    <id>https://lyblog2022.github.io/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/</id>
    <published>2022-06-07T13:17:08.000Z</published>
    <updated>2022-06-08T14:15:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>zookeeper内容发布及消息订阅</p><span id="more"></span><h3 id="1、向zookeeper中注册内容"><a href="#1、向zookeeper中注册内容" class="headerlink" title="1、向zookeeper中注册内容"></a>1、向zookeeper中注册内容</h3><p>新建项目ZookeeperClient</p><h4 id="1-1-创建-x2F-demo"><a href="#1-1-创建-x2F-demo" class="headerlink" title="1.1 创建&#x2F;demo"></a>1.1 创建&#x2F;demo</h4><p>使用zookeeper的客户端命令工具创建&#x2F;demo</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./zkCli.sh</span><br><span class="line">create /demos</span><br></pre></td></tr></table></figure><h4 id="1-2-添加依赖"><a href="#1-2-添加依赖" class="headerlink" title="1.2 添加依赖"></a>1.2 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-3-编写代码"><a href="#1-3-编写代码" class="headerlink" title="1.3 编写代码"></a>1.3 编写代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 创建zookeeper对象</span></span><br><span class="line"><span class="comment">            * 参数1：zookeeper IP+端口</span></span><br><span class="line"><span class="comment">            * 参数2：访问超时设置</span></span><br><span class="line"><span class="comment">            * 参数3：链接成功后，编写成功信息</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> <span class="string">&quot;192.168.253.132:2181&quot;</span>;</span><br><span class="line">           <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(ip, <span class="number">10000</span>, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">               <span class="meta">@Override</span></span><br><span class="line">               <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">                   System.out.println(<span class="string">&quot;获取链接&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line"></span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 向zookeeper发送内容</span></span><br><span class="line"><span class="comment">            * 参数1：发送的文件</span></span><br><span class="line"><span class="comment">            * 参数2：发送的内容</span></span><br><span class="line"><span class="comment">            * 参数3：权限</span></span><br><span class="line"><span class="comment">            * 参数4：内容的模式</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">content</span>  <span class="operator">=</span> zooKeeper.create(<span class="string">&quot;/demo/rmi-adress&quot;</span>,<span class="string">&quot;rmi:localhost:8080/demoService&quot;</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT_SEQUENTIAL);</span><br><span class="line">           System.out.println(<span class="string">&quot;content=&quot;</span>+content);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="1-4-控制台输出"><a href="#1-4-控制台输出" class="headerlink" title="1.4 控制台输出"></a>1.4 控制台输出</h4><img src="/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/zookeeper1.png" class="" title="zookeeper1 image"><h4 id="1-5-zookeeper输出"><a href="#1-5-zookeeper输出" class="headerlink" title="1.5 zookeeper输出"></a>1.5 zookeeper输出</h4><img src="/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/zookeeper2.png" class="" title="zookeeper2 image"><h4 id="1-6-异常"><a href="#1-6-异常" class="headerlink" title="1.6 异常"></a>1.6 异常</h4><img src="/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/zookeeper3.png" class="" title="zookeeper3 image"><p>解决方案—-防火墙未关闭</p><p>查看防火墙状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br></pre></td></tr></table></figure><img src="/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/zookeeper4.png" class="" title="zookeeper4 image"><p>active表示当前防火墙处于开启状态 inactive表示关闭状态<br>systemctl stop firewalld.service （关闭防火墙）<br>systemctl start firewalld.service （开启防火墙）<br>systemctl disable firewalld.service （禁止防火墙自启动）<br>systemctl enable firewalld.service （防火墙随系统开启启动）</p><p>关闭防火墙即可</p><h4 id="1-7-异常2—6-8新增"><a href="#1-7-异常2—6-8新增" class="headerlink" title="1.7 异常2—6.8新增"></a>1.7 异常2—6.8新增</h4><p>如果在关闭防火墙后仍出现以上问题</p><p>解决方案–用记事本打开C:\Windows\System32\drivers\etc\hosts文件，添加ZooKeeper部署的服务器ip，然后保存。</p><img src="/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/zookeeper6.png" class="" title="zookeeper6 image"><h3 id="2、zookeeper消息订阅"><a href="#2、zookeeper消息订阅" class="headerlink" title="2、zookeeper消息订阅"></a>2、zookeeper消息订阅</h3><h4 id="2-1-编写代码"><a href="#2-1-编写代码" class="headerlink" title="2.1 编写代码"></a>2.1 编写代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * 创建zookeeper对象</span></span><br><span class="line"><span class="comment">            * 参数1：zookeeper IP+端口</span></span><br><span class="line"><span class="comment">            * 参数2：访问超时设置</span></span><br><span class="line"><span class="comment">            * 参数3：链接成功后，编写成功信息</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> <span class="string">&quot;192.168.253.132:2181&quot;</span>;</span><br><span class="line">           <span class="type">ZooKeeper</span> <span class="variable">zooKeeper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(ip, <span class="number">10000</span>, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">               <span class="meta">@Override</span></span><br><span class="line">               <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">                   System.out.println(<span class="string">&quot;获取链接&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//从zookeeper中获取内容</span></span><br><span class="line">           <span class="comment">//2.1获取节点</span></span><br><span class="line">           List&lt;String&gt; list = zooKeeper.getChildren(<span class="string">&quot;/demo&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">           System.out.println(list);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//获取内容</span></span><br><span class="line">           <span class="keyword">for</span>(String child:list)&#123;</span><br><span class="line">               <span class="type">byte</span>[] result = zooKeeper.getData(<span class="string">&quot;/demo/&quot;</span>+child,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">               System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(result));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-控制台输出结果"><a href="#2-2-控制台输出结果" class="headerlink" title="2.2 控制台输出结果"></a>2.2 控制台输出结果</h4><img src="/2022/06/07/study/zookeeper%E4%BD%BF%E7%94%A8/zookeeper5.png" class="" title="zookeeper5 image">]]></content>
    
    
    <summary type="html">&lt;p&gt;zookeeper内容发布及消息订阅&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/zookeeper/"/>
    
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/tags/zookeeper/"/>
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>zookeeper常用命令</title>
    <link href="https://lyblog2022.github.io/2022/06/07/study/zookeeper/"/>
    <id>https://lyblog2022.github.io/2022/06/07/study/zookeeper/</id>
    <published>2022-06-07T12:53:54.000Z</published>
    <updated>2022-06-07T13:14:14.000Z</updated>
    
    <content type="html"><![CDATA[<p>zookeeper常用命令</p><span id="more"></span><h4 id="1、ls"><a href="#1、ls" class="headerlink" title="1、ls"></a>1、ls</h4><p>ls -s&#x2F;path</p><p>-s 详细信息，替代老版本ls2</p><p>-R 当前目录和子目录中内容都罗列出来</p><p>例如：ls -R &#x2F; 显示根目录下所有内容</p><img src="/2022/06/07/study/zookeeper/zookeeper1.png" class="" title="zookeeper1 image"><h4 id="2、create"><a href="#2、create" class="headerlink" title="2、create"></a>2、create</h4><p>create &#x2F;path [data]</p><p>[data] 包含内容</p><p>创建指定路径信息</p><p>例如：create &#x2F;demo 创建&#x2F;demo</p><img src="/2022/06/07/study/zookeeper/zookeeper2.png" class="" title="zookeeper2 image"><h4 id="3、get"><a href="#3、get" class="headerlink" title="3、get"></a>3、get</h4><p>get [-s] &#x2F;path</p><p>[-s] 详细信息</p><p>查看指定路径下内容。</p><p>例如： get -s &#x2F;demo</p><img src="/2022/06/07/study/zookeeper/zookeeper3.png" class="" title="zookeeper3 image"><p>null:存放的数据</p><p>cZxid:创建时zxid(znode每次改变时递增的事务id)</p><p>ctime:创建时间戳</p><p>mZxid:最近一次更新的zxid</p><p>mtime:最近一次更新的时间戳</p><p>pZxid:子节点的zxid</p><p>cversion:子节点更新次数</p><p>dataversion:节点数据更新次数</p><p>aclVersion:节点ACL(授权信息)的更新次数</p><p>ephemeralOwner:如果该节点为ephemeral节点(临时，生命周期与session一样), ephemeralOwner值表示与该节点绑定的session id. 如果该节点不是ephemeral节点, ephemeralOwner值为0.</p><p>dataLength:节点数据字节数</p><p>numChildren:子节点数量</p><h4 id="4、set"><a href="#4、set" class="headerlink" title="4、set"></a>4、set</h4><p>set &#x2F;path data</p><p>设置节点内容</p><img src="/2022/06/07/study/zookeeper/zookeeper5.png" class="" title="zookeeper5 image"><h4 id="5、delete"><a href="#5、delete" class="headerlink" title="5、delete"></a>5、delete</h4><p>delete &#x2F;path</p><p>删除节点</p><img src="/2022/06/07/study/zookeeper/zookeeper6.png" class="" title="zookeeper6 image">]]></content>
    
    
    <summary type="html">&lt;p&gt;zookeeper常用命令&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/zookeeper/"/>
    
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/tags/zookeeper/"/>
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 8 安装zookeeper</title>
    <link href="https://lyblog2022.github.io/2022/06/06/software/zookeeper/"/>
    <id>https://lyblog2022.github.io/2022/06/06/software/zookeeper/</id>
    <published>2022-06-06T13:43:24.000Z</published>
    <updated>2022-06-07T12:27:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS8安装zookeeper</p><span id="more"></span><h3 id="1、检验java环境"><a href="#1、检验java环境" class="headerlink" title="1、检验java环境"></a>1、检验java环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/zookeeper/jdk.png" class="" title="jdk image"><h3 id="2、安装wget-供文件下载时使用"><a href="#2、安装wget-供文件下载时使用" class="headerlink" title="2、安装wget,供文件下载时使用:"></a>2、安装wget,供文件下载时使用:</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install wget</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/zookeeper/zookeeper.png" class="" title="zookeeper image"><h3 id="3、下载zookeeper"><a href="#3、下载zookeeper" class="headerlink" title="3、下载zookeeper"></a>3、下载zookeeper</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.apache.org/zookeeper/zookeeper-3.8.0/apache-zookeeper-3.8.0-bin.tar.gz</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/zookeeper/zookeeper2.png" class="" title="zookeeper2 image"><h3 id="4、解压，安装"><a href="#4、解压，安装" class="headerlink" title="4、解压，安装"></a>4、解压，安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr</span><br><span class="line">mkdir zookeeper</span><br><span class="line">cd ./zookeeper</span><br><span class="line">tar -zxvf apache-zookeeper-3.8.0-bin.tar.gz</span><br><span class="line">mv apache-zookeeper-3.8.0-bin/ /usr/local/soft/</span><br></pre></td></tr></table></figure><p><em>这块我出现点问题，直接在跟目录下下载的，最好新建一个文件夹</em></p><h3 id="5、创建数据和日志目录"><a href="#5、创建数据和日志目录" class="headerlink" title="5、创建数据和日志目录"></a>5、创建数据和日志目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/zookeeper</span><br><span class="line">mkdir -p /data/zookeeper/data</span><br><span class="line">mkdir -p /data/zookeeper/datalogs</span><br><span class="line">mkdir -p /data/zookeeper/logs</span><br></pre></td></tr></table></figure><p>​说明：</p><ul><li>data:数据目录</li><li>datalogs:事务日志</li><li>logs:zk应用的日志</li></ul><h3 id="6、生成配置文件"><a href="#6、生成配置文件" class="headerlink" title="6、生成配置文件"></a>6、生成配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/soft/apache-zookeeper-3.8.0-bin/conf/</span><br><span class="line">cp zoo_sample.cfg zoo.cfg </span><br></pre></td></tr></table></figure><h3 id="7、设置配置文件"><a href="#7、设置配置文件" class="headerlink" title="7、设置配置文件"></a>7、设置配置文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi zoo.cfg</span><br></pre></td></tr></table></figure><p>添加内容</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/data/zookeeper/data</span><br><span class="line">dataLogDir=/data/zookeeper/datalogs</span><br><span class="line">admin.enableServer=false</span><br></pre></td></tr></table></figure><p>​说明：</p><ul><li>admin.enableServer&#x3D;false 用来关闭zk内置的web管理器</li><li>dataDir 定义了zk的数据目录</li><li>dataLogDir 定义了zk的事务日志</li></ul><h3 id="8、配置环境变量"><a href="#8、配置环境变量" class="headerlink" title="8、配置环境变量"></a>8、配置环境变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br></pre></td></tr></table></figure><p>在末尾增加以下内容:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ZK_HOME=/usr/local/soft/apache-zookeeper-3.8.0-bin</span><br><span class="line">export PATH=$ZK_HOME/bin:$PATH</span><br></pre></td></tr></table></figure><p>使环境变量生效:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure><h3 id="9、测试启动停止zookeeper"><a href="#9、测试启动停止zookeeper" class="headerlink" title="9、测试启动停止zookeeper"></a>9、测试启动停止zookeeper</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zkServer.sh start</span><br><span class="line">zkServer.sh stop</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/zookeeper/zookeeper3.png" class="" title="zookeeper3 image"><img src="/2022/06/06/software/zookeeper/zookeeper4.png" class="" title="zookeeper4 image">]]></content>
    
    
    <summary type="html">&lt;p&gt;CentOS8安装zookeeper&lt;/p&gt;</summary>
    
    
    
    <category term="CentOs 8" scheme="https://lyblog2022.github.io/categories/CentOs-8/"/>
    
    <category term="software" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/"/>
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/zookeeper/"/>
    
    
    <category term="software" scheme="https://lyblog2022.github.io/tags/software/"/>
    
    <category term="CentOS 8" scheme="https://lyblog2022.github.io/tags/CentOS-8/"/>
    
    <category term="zookeeper" scheme="https://lyblog2022.github.io/tags/zookeeper/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 8 配置JDK环境</title>
    <link href="https://lyblog2022.github.io/2022/06/06/software/jdk/"/>
    <id>https://lyblog2022.github.io/2022/06/06/software/jdk/</id>
    <published>2022-06-06T13:41:00.000Z</published>
    <updated>2022-06-06T14:33:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>CentOS 8 安装 JDK环境</p><span id="more"></span><h3 id="1、使用Yum安装"><a href="#1、使用Yum安装" class="headerlink" title="1、使用Yum安装"></a>1、使用Yum安装</h3><p>安装OpenJDK的可以选择此方法，方便快捷</p><h4 id="1-1-查看是否有JDK环境"><a href="#1-1-查看是否有JDK环境" class="headerlink" title="1.1 查看是否有JDK环境"></a>1.1 查看是否有JDK环境</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/jdk/jdk1.png" class="" title="jdk1 image"><p>可以看到系统自带的 OpenJDK 版本信息，如果不满足，则卸载现有JDK</p><h4 id="1-2-卸载现有JDK"><a href="#1-2-卸载现有JDK" class="headerlink" title="1.2 卸载现有JDK"></a>1.2 卸载现有JDK</h4><p>使用 rpm 命令查询 java</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep java</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/jdk/jdk2.png" class="" title="jdk2 image"><p>.noarch文件可以不用管，卸载其余条目</p><p>执行一下命令卸载信息</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e --nodeps java-1.8.0-openjdk-1.8.0.201.b09-2.el8.x86_64</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.201.b09-2.el8.x86_64</span><br></pre></td></tr></table></figure><p>卸载完后查询版本信息</p><img src="/2022/06/06/software/jdk/jdk3.png" class="" title="jdk3 image"><h4 id="1-3-使用Yum安装OpenJDK"><a href="#1-3-使用Yum安装OpenJDK" class="headerlink" title="1.3 使用Yum安装OpenJDK"></a>1.3 使用Yum安装OpenJDK</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk</span><br></pre></td></tr></table></figure><h5 id="1-3-1-报错"><a href="#1-3-1-报错" class="headerlink" title="1.3.1 报错"></a>1.3.1 报错</h5><img src="/2022/06/06/software/jdk/jdk4.png" class="" title="jdk4 image"><p>报错信息为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Failed to synchronize cache for repo &#x27;AppStream&#x27;, ignoring this repo.</span><br><span class="line">Failed to synchronize cache for repo &#x27;BaseOS&#x27;, ignoring this repo.</span><br></pre></td></tr></table></figure><h5 id="1-3-2-解决方案"><a href="#1-3-2-解决方案" class="headerlink" title="1.3.2 解决方案"></a>1.3.2 <strong>解决方案</strong></h5><p><a href="https://developer.aliyun.com/mirror/centos?spm=a2c6h.13651102.0.0.3e221b11CuEoi9">切换阿里源</a></p><p>1、备份</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure><p>2、下载新的 CentOS-Base.repo 到 &#x2F;etc&#x2F;yum.repos.d&#x2F;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo</span><br></pre></td></tr></table></figure><p>3、生成缓存</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure><img src="/2022/06/06/software/jdk/jdk5.png" class="" title="jdk5 image"><h4 id="1-4-校验"><a href="#1-4-校验" class="headerlink" title="1.4 校验"></a>1.4 校验</h4><img src="/2022/06/06/software/jdk/jdk6.png" class="" title="jdk6 image"><h3 id="2、使用rpm包安装"><a href="#2、使用rpm包安装" class="headerlink" title="2、使用rpm包安装"></a>2、使用rpm包安装</h3><p>适用于有提供RPM Package的情况，例如Oracle JDK有提供。</p><p><a href="https://www.oracle.com/java/technologies/downloads/archive/">Oracle JDK所有版本下载</a></p><p><a href="https://www.oracle.com/java/technologies/javase/javase8u211-later-archive-downloads.html">OracleJDK8下载</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;CentOS 8 安装 JDK环境&lt;/p&gt;</summary>
    
    
    
    <category term="CentOs 8" scheme="https://lyblog2022.github.io/categories/CentOs-8/"/>
    
    <category term="software" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/"/>
    
    <category term="jdk" scheme="https://lyblog2022.github.io/categories/CentOs-8/software/jdk/"/>
    
    
    <category term="software" scheme="https://lyblog2022.github.io/tags/software/"/>
    
    <category term="CentOS 8" scheme="https://lyblog2022.github.io/tags/CentOS-8/"/>
    
    <category term="jdk" scheme="https://lyblog2022.github.io/tags/jdk/"/>
    
  </entry>
  
  <entry>
    <title>RPC-远程服务调用</title>
    <link href="https://lyblog2022.github.io/2022/06/05/study/RPC/"/>
    <id>https://lyblog2022.github.io/2022/06/05/study/RPC/</id>
    <published>2022-06-05T08:45:21.000Z</published>
    <updated>2022-06-06T04:59:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>RPC–远程服务调用</p><span id="more"></span><h2 id="1、RPC"><a href="#1、RPC" class="headerlink" title="1、RPC"></a>1、RPC</h2><h3 id="1-1-RFC"><a href="#1-1-RFC" class="headerlink" title="1.1 RFC"></a>1.1 RFC</h3><p>​RFC(Request For Comments) 是由互联网工程任务组(IETF)发布的文件集。文件集中每个文件都有自己唯一编号，例如：rfc1831。目前RFC文件由互联网协会(Internet Society，ISOC)赞助发型。</p><p>​RPC就收集到了rfc 1831中。可以通过下面网址查看：</p><p>​<a href="https://datatracker.ietf.org/doc/rfc1831/">https://datatracker.ietf.org/doc/rfc1831/</a></p><h3 id="1-2-RPC"><a href="#1-2-RPC" class="headerlink" title="1.2 RPC"></a>1.2 RPC</h3><p>​<code>RPC</code>在<code>rfc 1831</code>中收录 ，<code>RPC</code>（<code>Remote Procedure Call</code>） 远程过程调用协议</p><p>​RPC协议规定允许互联网中一台主机程序调用另一台主机程序，而程序员无需对这个交互过程进行编程。在<code>RPC</code>协议中强调当A程序调用B程序中功能或方法时，A是不知道B中方法具体实现的。</p><p>​<code>RPC</code>是上层协议，底层可以基于<code>TCP</code>协议，也可以基于HTTP协议。一般我们说RPC都是基于RPC的<code>具体</code>实现，如：<code>Dubbo</code>框架。从广义上讲只要是满足网络中进行通讯调用都统称为<code>RPC</code>，甚至<code>HTTP</code>协议都可以说是<code>RPC</code>的具体实现，但是具体分析看来<code>RPC</code>协议要比<code>HTTP</code>协议更加高效，基于<code>RPC</code>的框架功能更多。</p><p>​<code>RPC</code>协议是基于分布式架构而出现的，所以<code>RPC</code>在分布式项目中有着得天独厚的优势。</p><h3 id="1-3-RPC和HTTP"><a href="#1-3-RPC和HTTP" class="headerlink" title="1.3 RPC和HTTP"></a>1.3 RPC和HTTP</h3><h4 id="1-3-1-具体实现"><a href="#1-3-1-具体实现" class="headerlink" title="1.3.1 具体实现"></a>1.3.1 具体实现</h4><p>​<code>RPC</code>：可以基于<code>TCP</code>协议，也可以基于<code>HTTP</code>协议。</p><p>​<code>HTTP</code>：基于<code>HTTP</code>协议</p><h4 id="1-3-2-效率"><a href="#1-3-2-效率" class="headerlink" title="1.3.2 效率"></a>1.3.2 效率</h4><p>​<code>RPC</code>：自定义具体实现可以减少很多无用的报文内容，使得报文体积更小。</p><p>​<code>HTTP</code>：如果是<code>HTTP 1.1</code> 报文中很多内容都是无用的。如果是<code>HTTP2.0</code>以后和<code>RPC</code>相差不大，比<code>RPC</code>少的可能就是一些服务治理等功能。</p><h4 id="1-3-3-链接方式"><a href="#1-3-3-链接方式" class="headerlink" title="1.3.3 链接方式"></a>1.3.3 链接方式</h4><p>​<code>RPC</code>：长连接支持。</p><p>​<code>HTTP</code>：每次连接都是3次握手。</p><h4 id="1-3-4-性能"><a href="#1-3-4-性能" class="headerlink" title="1.3.4 性能"></a>1.3.4 性能</h4><p>​<code>RPC</code>：可以基于很多序列化方式。如：<code>thrift</code></p><p>​<code>HTTP</code>：主要是通过<code>JSON</code>，序列化和反序列效率更低。</p><h4 id="1-3-5-注册中心"><a href="#1-3-5-注册中心" class="headerlink" title="1.3.5 注册中心"></a>1.3.5 注册中心</h4><p>​<code>RPC </code>：一般RPC框架都带有注册中心。</p><p>​<code>HTTP</code>：都是直连。</p><h4 id="1-3-6-负载均衡"><a href="#1-3-6-负载均衡" class="headerlink" title="1.3.6 负载均衡"></a>1.3.6 负载均衡</h4><p>​<code>RPC</code>：绝大多数RPC框架都带有负载均衡测量。</p><p>​<code>HTTP</code>：一般都需要借助第三方工具。如：<code>nginx</code></p><h4 id="1-3-7-综合结论"><a href="#1-3-7-综合结论" class="headerlink" title="1.3.7 综合结论"></a>1.3.7 综合结论</h4><p>​<code>RPC</code>框架：一般都带有丰富的服务治理等功能，更适合企业内部接口调用。</p><p>​<code>HTTP</code>：更适合多平台之间相互调用。</p><h2 id="2、HttpClient实现RPC"><a href="#2、HttpClient实现RPC" class="headerlink" title="2、HttpClient实现RPC"></a>2、HttpClient实现RPC</h2><h3 id="2-1-HttpClient简介"><a href="#2-1-HttpClient简介" class="headerlink" title="2.1 HttpClient简介"></a>2.1 HttpClient简介</h3><p>​在<code>JDK</code>中<code>java.net</code>包下提供了用户<code>HTTP</code>访问的基本功能，但是它缺少灵活性或许多应用所需要的功能。</p><p>​<code>HttpClient</code>起初是<code>Apache Jakarta Common</code> 的子项目。用来提供高效的、最新的、功能丰富的支持 <code>HTTP </code>协议的客户端编程工具包，并且它支持 <code>HTTP </code>协议最新的版本。2007年成为顶级项目。</p><p>​通俗解释：<code>HttpClient</code>可以实现使用<code>Java</code>代码完成标准<code>HTTP</code>请求及响应。</p><h3 id="2-2-代码实现"><a href="#2-2-代码实现" class="headerlink" title="2.2 代码实现"></a>2.2 代码实现</h3><h4 id="2-2-1-服务端"><a href="#2-2-1-服务端" class="headerlink" title="2.2.1 服务端"></a>2.2.1 服务端</h4><p>1、新建控制器</p><p>com.controller.DemoController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/demo&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">(String param)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;demo&quot;</span>+param;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、启动器</p><p>com.HttpClientServerApplication</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientServerApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(HttpClientServerApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-2-2-客户端"><a href="#2-2-2-客户端" class="headerlink" title="2.2.2 客户端"></a>2.2.2 客户端</h4><p>1、添加依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、新建类</p><p>新建com.HttpClientDemo，编写主方法。</p><p>​1、使用Get方法访问</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//创建http工具（理解成:浏览器） 发起请求，解析响应</span></span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">        <span class="comment">//请求路径</span></span><br><span class="line">        <span class="type">URIBuilder</span> <span class="variable">uriBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(<span class="string">&quot;http://localhost:8080/demo&quot;</span>);</span><br><span class="line">        uriBuilder.addParameter(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;get123&quot;</span>);</span><br><span class="line">        <span class="comment">//创建HttpGet请求对象</span></span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uriBuilder.build());</span><br><span class="line">        <span class="comment">//创建响应对象</span></span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(get);</span><br><span class="line">        <span class="comment">//由于响应体是字符串，因此把HttpEntity类型转换为字符串类型，并设置字符编码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">//输出结果</span></span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        response.close();</span><br><span class="line">        httpClient.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​2、使用Post方式访问</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//创建http工具（理解成:浏览器） 发起请求，解析响应</span></span><br><span class="line">            <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">            <span class="comment">//创建HttpPOST请求对象</span></span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/demo&quot;</span>);</span><br><span class="line">            <span class="comment">//所有请求参数</span></span><br><span class="line">            List&lt;NameValuePair&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            params.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;param&quot;</span>,<span class="string">&quot;123&quot;</span>));</span><br><span class="line">            <span class="comment">//创建HttpEntity接口的文本实现类的对象，放入参数并设置编码</span></span><br><span class="line">            <span class="type">HttpEntity</span> <span class="variable">httpEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(params,<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            <span class="comment">//放入到HttpPost对象中</span></span><br><span class="line">            post.setEntity(httpEntity);            </span><br><span class="line">            <span class="comment">//创建响应对象</span></span><br><span class="line">            <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(post);</span><br><span class="line">            <span class="comment">//由于响应体是字符串，因此把HttpEntity类型转换为字符串类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">            <span class="comment">//输出结果</span></span><br><span class="line">            System.out.println(result);</span><br><span class="line">            <span class="comment">//释放资源</span></span><br><span class="line">            response.close();</span><br><span class="line">            httpClient.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-Jackson用法"><a href="#2-3-Jackson用法" class="headerlink" title="2.3 Jackson用法"></a>2.3 Jackson用法</h3><h4 id="2-3-1-对象-–-gt-json字符串"><a href="#2-3-1-对象-–-gt-json字符串" class="headerlink" title="2.3.1 对象 –&gt; json字符串"></a>2.3.1 对象 –&gt; json字符串</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"><span class="type">People</span> <span class="variable">peo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>();</span><br><span class="line">objectMapper.writeValueAsString(peo);</span><br></pre></td></tr></table></figure><h4 id="2-3-2-json-–-gt-对象"><a href="#2-3-2-json-–-gt-对象" class="headerlink" title="2.3.2 json –&gt; 对象"></a>2.3.2 json –&gt; 对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"><span class="type">People</span> <span class="variable">peo</span> <span class="operator">=</span> objectMapper.readValue(content, People.class);</span><br></pre></td></tr></table></figure><h4 id="2-3-3-json-–-gt-List集合"><a href="#2-3-3-json-–-gt-List集合" class="headerlink" title="2.3.3 json –&gt; List集合"></a>2.3.3 json –&gt; List集合</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"><span class="type">JavaType</span> <span class="variable">javaType</span> <span class="operator">=</span> objectMapper.getTypeFactory().constructParametricType(List.class, People.class);</span><br><span class="line">List&lt;People&gt; list = objectMapper.readValue(content, javaType);</span><br></pre></td></tr></table></figure><h3 id="2-4-HttpClient请求包含JSON"><a href="#2-4-HttpClient请求包含JSON" class="headerlink" title="2.4 HttpClient请求包含JSON"></a>2.4 HttpClient请求包含JSON</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">            <span class="type">HttpPost</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/demo&quot;</span>);</span><br><span class="line">            HttpEntity httpEntity= <span class="literal">null</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">            <span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(json, ContentType.APPLICATION_JSON);</span><br><span class="line">            post.setEntity(entity);</span><br><span class="line">            <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(post);</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">            System.out.println(result);</span><br><span class="line">            response.close();</span><br><span class="line">            httpClient.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-控制器接口参数"><a href="#2-5-控制器接口参数" class="headerlink" title="2.5 控制器接口参数"></a>2.5 控制器接口参数</h3><p>@RequestBody把请求体中流数据转换为指定的对象。多用在请求参数是json数据且请求的Content-Type&#x3D;”application&#x2F;json”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/demo4&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">demo4</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;People&gt; list)</span> &#123;</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    <span class="keyword">return</span> list.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-Ajax发送json参数写法"><a href="#2-6-Ajax发送json参数写法" class="headerlink" title="2.6 Ajax发送json参数写法"></a>2.6 Ajax发送json参数写法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var json = &#x27;[&#123;&quot;id&quot;:123,&quot;name&quot;:&quot;ly&quot;&#125;,&#123;&quot;id&quot;:123,&quot;name&quot;:&quot;ly123&quot;&#125;]&#x27;;</span><br><span class="line"> $.ajax(&#123;</span><br><span class="line">     url:&#x27;/demo5&#x27;,</span><br><span class="line">     type:&#x27;post&#x27;,</span><br><span class="line">     success:function(data)&#123;</span><br><span class="line">         alert(data);</span><br><span class="line">         for(var i = 0 ;i&lt;data.length;i++)&#123;</span><br><span class="line">alert(data[i].id +&quot;  &quot;+data[i].name);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     contentType:&#x27;application/json&#x27;,//请求体中内容类型</span><br><span class="line">     dataType:&#x27;json&#x27;,//响应内容类型。</span><br><span class="line">     data:json</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h3 id="2-7-跨域"><a href="#2-7-跨域" class="headerlink" title="2.7 跨域"></a>2.7 跨域</h3><p>跨域：协议、IP、端口中只要有一个不同的就是跨域请求</p><p>同源策略：浏览器默认只允许ajax访问同源（协议、IP、端口）内容</p><p>解决同源策略：在控制器接口上添加@CrossOrigin。表示允许跨域。本质在响应头中添加Access-Control-Allow-Origin: *</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">var json = &#x27;[&#123;&quot;id&quot;:123,&quot;name&quot;:&quot;ly&quot;&#125;,&#123;&quot;id&quot;:456,&quot;name&quot;:&quot;ly1234&quot;&#125;]&#x27;;</span><br><span class="line"> $.ajax(&#123;</span><br><span class="line">     url:&#x27;/demo5&#x27;,</span><br><span class="line">     type:&#x27;post&#x27;,</span><br><span class="line">     success:function(data)&#123;</span><br><span class="line">         alert(data);</span><br><span class="line">         for(var i = 0 ;i&lt;data.length;i++)&#123;</span><br><span class="line"></span><br><span class="line">             alert(data[i].id +&quot;  &quot;+data[i].name);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">     contentType:&#x27;application/json&#x27;,//请求体中内容类型</span><br><span class="line">     dataType:&#x27;json&#x27;,//响应内容类型。</span><br><span class="line">     data:json</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h2 id="3、RMI实现RPC"><a href="#3、RMI实现RPC" class="headerlink" title="3、RMI实现RPC"></a>3、RMI实现RPC</h2><h3 id="3-1-RMI简介"><a href="#3-1-RMI简介" class="headerlink" title="3.1 RMI简介"></a>3.1 RMI简介</h3><ul><li>RMI(Remote Method Invocation) 远程方法调用。</li><li>RMI是从JDK1.2推出的功能，它可以实现在一个Java应用中可以像调用本地方法一样调用另一个服务器中Java应用（JVM）中的内容。</li><li>RMI 是Java语言的远程调用，无法实现跨语言。</li></ul><h3 id="3-2-执行流程"><a href="#3-2-执行流程" class="headerlink" title="3.2 执行流程"></a>3.2 执行流程</h3><img src="/2022/06/05/study/RPC/rpc-01.png" class="" title="rpc-01 image"><p>​Registry(注册表)是放置所有服务器对象的命名空间。 每次服务端创建一个对象时，它都会使用bind()或rebind()方法注册该对象。 这些是使用称为绑定名称的唯一名称注册的。 </p><p>​要调用远程对象，客户端需要该对象的引用。即通过服务端绑定的名称从注册表中获取对象(lookup()方法)。</p><h3 id="3-3-API"><a href="#3-3-API" class="headerlink" title="3.3 API"></a>3.3 API</h3><h4 id="3-3-1-Remote"><a href="#3-3-1-Remote" class="headerlink" title="3.3.1 Remote"></a>3.3.1 Remote</h4><p>java.rmi.Remote 定义了此接口为远程调用接口。如果接口被外部调用，需要继承此接口。</p><h4 id="3-3-2-RemoteException"><a href="#3-3-2-RemoteException" class="headerlink" title="3.3.2 RemoteException"></a>3.3.2 RemoteException</h4><p>​java.rmi.RemoteException</p><p>​继承了Remote接口的接口中，如果方法是允许被远程调用的，需要抛出此异常。</p><h4 id="3-3-3-UnicastRemoteObject"><a href="#3-3-3-UnicastRemoteObject" class="headerlink" title="3.3.3 UnicastRemoteObject"></a>3.3.3 UnicastRemoteObject</h4><p>​java.rmi.server.UnicastRemoteObject</p><p>​此类实现了Remote接口和Serializable接口。</p><p>​自定义接口实现类除了实现自定义接口还需要继承此类。</p><h4 id="3-3-4-LocateRegistry"><a href="#3-3-4-LocateRegistry" class="headerlink" title="3.3.4 LocateRegistry"></a>3.3.4 LocateRegistry</h4><p>​java.rmi.registry.LocateRegistry</p><p>​可以通过LocateRegistry在本机上创建Registry，通过特定的端口就可以访问这个Registry。</p><h4 id="3-3-5-Naming"><a href="#3-3-5-Naming" class="headerlink" title="3.3.5 Naming"></a>3.3.5 Naming</h4><p>​java.rmi.Naming</p><p>​Naming定义了发布内容可访问RMI名称。也是通过Naming获取到指定的远程方法。</p><h3 id="3-4-代码实现"><a href="#3-4-代码实现" class="headerlink" title="3.4 代码实现"></a>3.4 代码实现</h3><h4 id="3-4-1-服务端"><a href="#3-4-1-服务端" class="headerlink" title="3.4.1 服务端"></a>3.4.1 服务端</h4><p>1、编写接口</p><p>com.service.DemoService 编写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DemoService</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    String <span class="title function_">demo</span><span class="params">(String demo)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2、编写实现类</p><p>com.service.impl.DemoServiceImpl 编写。</p><p>注意：构造方法是public的。默认生成protected</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DemoServiceImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">(String demo)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> demo+<span class="string">&quot;123&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3、主方法</p><p>编写com.DemoServer类，生成主方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DemoServiceImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">(String demo)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> demo+<span class="string">&quot;123&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4、运行项目</p><p>运行后项目，项目一直处于启动状态，表示可以远程访问此项目中的远程方法。</p><h4 id="3-4-2-创建客户端代码"><a href="#3-4-2-创建客户端代码" class="headerlink" title="3.4.2  创建客户端代码"></a>3.4.2  创建客户端代码</h4><p>1、复制服务端接口</p><p>把服务端com.service.DemoService粘贴到项目中</p><p>2、创建主方法</p><p>新建com.DemoClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">DemoService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DemoServiceImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">demo</span><span class="params">(String demo)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> demo+<span class="string">&quot;123&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;RPC–远程服务调用&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="RPC" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/RPC/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="RPC" scheme="https://lyblog2022.github.io/tags/RPC/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot</title>
    <link href="https://lyblog2022.github.io/2022/06/05/study/SpringBoot/"/>
    <id>https://lyblog2022.github.io/2022/06/05/study/SpringBoot/</id>
    <published>2022-06-05T07:02:13.000Z</published>
    <updated>2022-06-05T08:35:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>SpringBoot学习1</p><span id="more"></span><h2 id="1、SpringBoot"><a href="#1、SpringBoot" class="headerlink" title="1、SpringBoot "></a>1、<code>SpringBoot </code></h2><h3 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h3><ul><li><code>Spring Boot</code>是<code>Spring</code>公司的一个顶级项目，和<code>Spring Framework</code>是一个级别的。</li><li><code>Spring Boot</code>实际上是利用<code>Spring Framework 4</code> 自动配置特性完成。编写项目时不需要编写<code>xml</code>文件。发展到现在，<code>Spring Boot</code>已经具有很很大的生态圈，各种主流技术已经都提供了<code>Spring Boot</code>的启动器。</li></ul><h3 id="1-2-启动器"><a href="#1-2-启动器" class="headerlink" title="1.2 启动器"></a>1.2 启动器</h3><p>​<code>Spring</code>框架在项目中作用是<code>Spring</code>整合各种其他技术，让其他技术使用更加方便。<code>Spring Boot</code>的启动器实际上就是一个依赖。这个依赖中包含了整个这个技术的相关<code>jar</code>包，还包含了这个技术的自动配置，以前绝大多数<code>XML</code>配置都不需要配置了。当然了，启动器中自动配置无法实现所有内容的自动配置，在使用<code>Spring Boot</code>时还需要进行少量的配置（这个配置不是在<code>xml</code>中了，而是在<code>properties</code>或<code>yml</code>中即可）。如果是<code>Spring</code>自己封装的启动器的<code>artifact id</code>名字满足：<code>spring-boot-starter-xxxx</code>，如果是第三方公司提供的启动满足：<code>xxxx-spring-boot-starter</code>。以后每次使用<code>Spring Boot</code>整合其他技术时首先需要考虑导入启动器。 </p><h3 id="1-3-优点"><a href="#1-3-优点" class="headerlink" title="1.3 优点"></a>1.3 优点</h3><ol><li>使用<code>Spring Boot</code>可以创建独立的<code>Spring</code>应用程序</li><li>在<code>Spring Boot</code>中直接嵌入了<code>Tomcat</code>、<code>Jetty</code>、<code>Undertow</code>等<code>Web </code>容器，在使用<code>SpringBoot</code>做<code>Web</code>开发时不需要部署<code>WAR</code>文件</li><li>通过提供自己的启动器(<code>Starter</code>)依赖，简化项目构建配置</li><li>尽量的自动配置<code>Spring</code>和第三方库</li><li>绝对没有代码生成，也不需要<code>XML</code>配置文件</li></ol><h3 id="1-4-核心"><a href="#1-4-核心" class="headerlink" title="1.4 核心"></a>1.4 核心</h3><p>起步依赖- 起步依赖本质上是一个<code>Maven</code>项目对象模型（<code>Project Object Model</code>，<code>POM</code>），定义了对其他库的传递依赖，这些东西加在一起即支持某项功能。 简单的说，起步依赖就是将具备某种功能的坐标打包到一起，并提供一些默认的功能。 </p><p>自动配置 -<code>Spring Boot</code>的自动配置是一个运行时（更准确地说，是应用程序启动时）的过程，考虑了众多因素，才决定 <code>Spring</code>配置应该用哪个，不该用哪个。该过程是<code>Spring</code>自动完成的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;SpringBoot学习1&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="springboot" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/springboot/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="springboot" scheme="https://lyblog2022.github.io/tags/springboot/"/>
    
  </entry>
  
  <entry>
    <title>SpringMVC</title>
    <link href="https://lyblog2022.github.io/2022/06/05/study/SpringMVC/"/>
    <id>https://lyblog2022.github.io/2022/06/05/study/SpringMVC/</id>
    <published>2022-06-05T04:55:50.000Z</published>
    <updated>2022-06-05T06:55:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>Springmvc学习</p><span id="more"></span><h2 id="1、SpringMVC"><a href="#1、SpringMVC" class="headerlink" title="1、SpringMVC"></a>1、SpringMVC</h2><h3 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h3><ul><li><code>SpringMVC</code>是<code>spring</code>为展现层提供的基于<code>MVC</code>设计理念的优秀WEB框架，是目前最主流的<code>MVC</code>框架之一</li><li><code>SpringMVC</code>通过一套注解，可以让普通的<code>JAVA</code>类成为<code>contrllor</code>控制器，无需继承<code>Servlet</code>，实现了控制层和<code>Servlet</code>之间的解耦</li><li><code>SpringMVC</code>支持<code>Rest</code>风格的<code>URL</code>写法</li><li><code>SpringMVC</code>采用了松耦合，可热插的主键结构，比其他的框架更具扩展性和灵活性</li></ul><h3 id="1-2-执行流程"><a href="#1-2-执行流程" class="headerlink" title="1.2 执行流程"></a>1.2 执行流程</h3><ol><li><p><code>DispatcherServlet</code>：前端控制器</p><p>用户请求到达前端控制器，它就相当于 <code>mvc</code> 模式中的 <code>c</code>，<code>dispatcherServlet </code>是整个流程控制的中心，由它调用其它组件处理用户的请求，<code>dispatcherServlet </code>的存在降低了组件之间的耦合性。</p></li><li><p><code>HandlerMapping</code>：处理器映射器</p><p><code>HandlerMapping </code>负责根据用户请求找到 <code>Handler </code>即处理器，<code>SpringMVC </code>提供了不同的映射器实现不同的 映射方式，例如：配置文件方式，实现接口方式，注解方式等。</p><p><code>HandlerMapping</code>的实现类的作用：实现类<code>RequestMappingHandlerMapping</code>，它会处理<code>@RequestMapping</code> 注解，并将其注册到请求映射表中。</p></li><li><p><code>Handler</code>：处理器 (自己定义的<code>Controller</code>处理单元)</p><p>它就是我们开发中要编写的具体业务控制器。由 <code>DispatcherServlet </code>把用户请求转发到 <code>Handler</code>。由 <code>Handler </code>对具体的用户请求进行处理。</p></li><li><p><code>HandlAdapter</code>：处理器适配器</p><p>通过 <code>HandlerAdapter</code> 对处理器进行执行，这是适配器模式的应用，通过扩展适配器可以对更多类型的处理器进行执行</p><p><code>HandlerAdapter</code>的实现类的作用：实现类<code>RequestMappingHandlerAdapter</code>，则是处理请求的适配器，确定调用哪个类的哪个方法，并且构造方法参数，返回值。</p></li><li><p><code>View Resolver</code>：视图解析器</p><p><code>View Resolver</code> 负责将处理结果生成 <code>View </code>视图，<code>View Resolver</code> 首先根据逻辑视图名解析成物理视图名 即具体的页面地址，再生成 <code>View </code>视图对象，最后对 <code>View </code>进行渲染将处理结果通过页面展示给用户。</p></li><li><p><code>View</code>：视图</p><p><code>SpringMVC </code>框架提供了很多的 <code>View </code>视图类型的支持，包括：<code>jstlView</code>、<code>freemarkerView</code>、<code>pdfView</code>等。我们最常用的视图就是 <code>jsp</code>。 一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开 发具体的页面。</p></li></ol><h2 id="2、-获取请求参数"><a href="#2、-获取请求参数" class="headerlink" title="2、 获取请求参数"></a>2、 获取请求参数</h2><h3 id="2-1-紧耦合方式"><a href="#2-1-紧耦合方式" class="headerlink" title="2.1 紧耦合方式"></a>2.1 紧耦合方式</h3><p>​<code>DispatcherServlet</code>中的<code>service</code>方法直接将此次请求的<code>request</code>对象传递给调用的单元方法即可。同时在单元方法上声明形参<code>HttpServletRequest</code>来接收<code>request</code>实参即可。</p><h3 id="2-2-解耦合方式"><a href="#2-2-解耦合方式" class="headerlink" title="2.2 解耦合方式"></a>2.2 解耦合方式</h3><p>​<code>DispatcherServlet</code>在其<code>service</code>方法中将请求数据根据需求从<code>request</code>对象中获取出来后，将数据直接传递给对应的单元方法使用。同时在单元方法上直接声明对应的形参接收请求数据即可。在单元方法上声明形参来接收请求数据时，形参名必须和请求数据的键名一致，<code>DispatcherServlet</code>会将调用单元方法的形参名作为请求数据的键名获取请求数据，然后传递给单元方法。</p><h3 id="2-3-常见注解"><a href="#2-3-常见注解" class="headerlink" title="2.3 常见注解"></a>2.3 常见注解</h3><h4 id="2-3-1-RequestMapping"><a href="#2-3-1-RequestMapping" class="headerlink" title="2.3.1 @RequestMapping"></a>2.3.1 <strong>@RequestMapping</strong></h4><ul><li>作用：用于建立请求 <code>URL </code>和处理请求方法之间的对应关系</li><li>出现位置：<ul><li>类上：请求 <code>URL </code>的第一级访问目录。此处不写的话，就相当于应用的根目录。写的话需要以&#x2F;开头</li><li>方法上：请求 <code>URL </code>的第二级访问目录</li></ul></li><li>属性：<ul><li><code>value</code>：用于指定请求的 <code>URL</code>。它和 <code>path </code>属性的作用是一样的。</li><li><code>method</code>：用于指定请求的方式。</li></ul></li></ul><h4 id="2-3-2-RequestParam"><a href="#2-3-2-RequestParam" class="headerlink" title="2.3.2 @RequestParam"></a>2.3.2 @RequestParam</h4><ul><li><p>作用：把请求中指定名称的参数给控制器中的形参赋值。</p></li><li><p>属性：</p><ul><li><code>value</code>：请求参数中的名称。</li><li><code>required</code>：请求参数中是否必须提供此参数。默认值：<code>true</code>。表示必须提供，如果不提供将报错。</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/getRequestParam&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getRequestParam</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String uname, <span class="meta">@RequestParam(value=&quot;age&quot;, required=false)</span> Integer age)</span> &#123; </span><br><span class="line">System.out.println(username+<span class="string">&quot;,&quot;</span>+age); </span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;success&quot;</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-3-3-PathVariable"><a href="#2-3-3-PathVariable" class="headerlink" title="2.3.3 @PathVariable"></a>2.3.3 @PathVariable</h4><ul><li>作用：用于绑定 <code>url </code>中的占位符。例如：请求 <code>url </code>中 &#x2F;<code>delete</code>&#x2F;**{id}<strong>，这个</strong>{id}**就是 <code>url </code>占位符。 <code>url </code>支持占位符是 <code>spring3.0 </code>之后加入的。是 <code>springmvc </code>支持 <code>rest </code>风格 <code>URL </code>的一个重要标志。</li><li>属性：<ul><li><code>value</code>：用于指定 <code>url </code>中占位符名称。</li><li><code>required</code>：是否必须提供占位符。</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathController</span> &#123;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/testPathVariable/&#123;id&#125;/&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testPathVariable</span><span class="params">( <span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id, <span class="meta">@PathVariable(&quot;username&quot;)</span> String username)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;id:&quot;</span>+id);</span><br><span class="line">System.out.println(<span class="string">&quot;username:&quot;</span>+username);</span><br><span class="line">System.out.println(<span class="string">&quot;testPathVariable1&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3、作用域传参"><a href="#3、作用域传参" class="headerlink" title="3、作用域传参"></a>3、作用域传参</h2><h3 id="3-1-PageContext对象"><a href="#3-1-PageContext对象" class="headerlink" title="3.1 PageContext对象"></a>3.1 PageContext对象</h3><ul><li>作用域范围：当前jsp页面内有效</li></ul><h3 id="3-2-request对象"><a href="#3-2-request对象" class="headerlink" title="3.2 request对象"></a>3.2 request对象</h3><ul><li>作用域范围：一次请求内。</li><li>作用: 解决了一次请求内的资源的数据共享问题</li></ul><h3 id="3-3-session对象"><a href="#3-3-session对象" class="headerlink" title="3.3 session对象"></a>3.3 session对象</h3><ul><li>作用域范围：一次会话内有效。</li><li>说明：浏览器不关闭，并且后台的session不失效，在任意请求中都可以获取到同一个session对象。</li><li>作用：解决了一个用户不同请求的数据共享问题。</li></ul><h3 id="3-4-application-ServletContext-对象"><a href="#3-4-application-ServletContext-对象" class="headerlink" title="3.4 application(ServletContext)对象"></a>3.4 application(ServletContext)对象</h3><ul><li>作用域范围：整个项目内有效。</li><li>特点：一个项目只有一个，在服务器启动的时候即完成初始化创建无论如何获取都是同一个项目。</li><li>作用：解决了不同用户的数据共享问题。</li></ul><h2 id="4、拦截器"><a href="#4、拦截器" class="headerlink" title="4、拦截器"></a>4、拦截器</h2><p><code>Spring MVC</code>中的拦截器（<code>Interceptor</code>）类似于Servlet中的过滤器（<code>Filter</code>），它主要用于拦截用户请求并作相应的处理。例如通过拦截器可以进行权限验证、记录请求信息的日志、判断用户是否登录等。</p><p>  要使用<code>Spring MVC</code>中的拦截器，就需要对拦截器类进行定义和配置。通常拦截器类可以通过两种方式来定义。 </p><ol><li><p>通过实现<code>HandlerInterceptor</code>接口，或继承<code>HandlerInterceptor</code>接口的实现类（如<code>HandlerInterceptorAdapter</code>）来定义。 </p></li><li><p>通过实现<code>WebRequestInterceptor</code>接口，或继承<code>WebRequestInterceptor</code>接口的实现类来定义。</p></li></ol><h3 id="4-1-拦截器过滤器区别"><a href="#4-1-拦截器过滤器区别" class="headerlink" title="4.1 拦截器过滤器区别"></a>4.1 拦截器过滤器区别</h3><ol><li>拦截器<code>SpringMVC</code>的，而过滤器是<code>servlet</code>的。</li><li>拦截器不依赖与<code>servlet</code>容器，由<code>spring</code>容器初始化，过滤器依赖与<code>servlet</code>容器，由<code>servlet</code>容器初始化。</li><li>拦截器只能对<code>action</code>请求起作用，而过滤器则可以对几乎所有的请求起作用。</li><li>拦截器可以访问<code>action</code>上下文、值栈里的对象，而过滤器不能访问。</li><li>在<code>action</code>的生命周期中，拦截器可以多次被调用，而过滤器只能在容器初始化时被调用一次。</li><li>拦截器可以获取<code>IOC</code>容器中的各个<code>bean</code>，而过滤器就不太方便，这点很重要，在拦截器里注入一个<code>service</code>，可以调用业务逻辑。</li></ol><h3 id="4-2-preHandle方法"><a href="#4-2-preHandle方法" class="headerlink" title="4.2 preHandle方法"></a>4.2 preHandle方法</h3><ul><li><p>执行时机：再进入控制单元方法之前执行</p></li><li><p>调用：按拦截器定义顺序调用</p></li><li><p>具体作用：如果程序员决定该拦截器对请求进行拦截处理后还要调用其他的拦截器，或者是业务处理器去 进行处理，则返回 <code>true</code>。 如果程序员决定不需要再调用其他的组件去处理请求，则返回 <code>false</code>。</p></li><li><p>参数：</p><ul><li><code>HttpServletRequest arg0</code>，拦截的请求的<code>request</code>对象</li><li><code>HttpServletResponse arg1</code>，拦截的请求的<code>response</code>对象</li><li><code>Object arg2</code> 封存了单元方法对象的<code>HandleMethod</code>对象</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request  请求对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler  目标要调用的Handler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回true放行,返回false拦截</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">/*在请求到达我们定义的handler之前工作的*/</span></span><br><span class="line">System.out.println(<span class="string">&quot;MyInterceptor preHandle&quot;</span>);</span><br><span class="line"><span class="comment">/*设置请求和响应的乱码 */</span></span><br><span class="line"><span class="comment">/* request.setCharacterEncoding(&quot;UTF-8&quot;);</span></span><br><span class="line"><span class="comment">response.setCharacterEncoding(&quot;UTF-8&quot;);*/</span></span><br><span class="line"><span class="comment">// 判断是否登录</span></span><br><span class="line"><span class="comment">/*User user =(User) request.getSession().getAttribute(&quot;user&quot;);</span></span><br><span class="line"><span class="comment">if(null == user)</span></span><br><span class="line"><span class="comment">response.sendRedirect(&quot;index.jsp&quot;);</span></span><br><span class="line"><span class="comment">return false;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 用户权限控制</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-3-postHandle方法"><a href="#4-3-postHandle方法" class="headerlink" title="4.3 postHandle方法"></a>4.3 postHandle方法</h3><ul><li><p>执行时机：在进行数据处理和做出响应之间进行这个方法的调用</p></li><li><p>调用：在拦截器链内所有拦截器返成功调用</p></li><li><p>作用：在业务处理器处理完请求后，但是 <code>DispatcherServlet</code> 向客户端返回响应前被调用，在该方法中对用户请求 <code>request</code>域数据进行处理。</p></li><li><p>参数：</p><ul><li><code>HttpServletRequest arg0</code>，拦截的请求的<code>request</code>对象</li><li><code>HttpServletResponse arg1</code>，拦截的请求的<code>response</code>对象</li><li><code>Object arg2</code>，封存了单元方法对象的<code>HandleMethod</code>对象</li><li><code>ModelAndView arg3</code>，封存了单元方法的返回值资源路径和请求转到的<code>Map</code>数据</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> modelAndView  controller响应的结果,视图和数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;MyInterceptor postHandle&quot;</span>);</span><br><span class="line"><span class="comment">/*控制数据*/</span></span><br><span class="line"><span class="comment">/*Map&lt;String, Object&gt; map = modelAndView.getModel();</span></span><br><span class="line"><span class="comment">String msg = (String)map.get(&quot;msg&quot;);</span></span><br><span class="line"><span class="comment">String newMsg = msg.replaceAll(&quot;脏话&quot;, &quot;**&quot;);</span></span><br><span class="line"><span class="comment">map.put(&quot;msg&quot;, newMsg);*/</span></span><br><span class="line"><span class="comment">/*控制视图*/</span></span><br><span class="line"><span class="comment">/*modelAndView.setViewName(&quot;/testDemo1.jsp&quot;);*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4-afterCompletion方法"><a href="#4-4-afterCompletion方法" class="headerlink" title="4.4 afterCompletion方法"></a>4.4 afterCompletion方法</h3><ul><li><p>执行时机：在进行页面渲染的时候执行</p></li><li><p>调用：按拦截器定义逆序调用</p></li><li><p>作用：在<code>DispatcherServlet </code>完全处理完请求后被调用,可以在该方法中进行一些资源清理的操作。</p></li><li><p>参数：</p><ul><li><code>HttpServletRequest arg0</code>，拦截的请求的<code>request</code>对象</li><li><code>HttpServletResponse arg1</code>，拦截的请求的<code>response</code>对象</li><li><code>Object arg2</code>，封存了单元方法对象的<code>HandleMethod</code>对象</li><li><code>Exception arg3</code>，存储了责任链的异常信息</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 无论controller是否出现异常,都会执行的方法</span></span><br><span class="line"><span class="comment"> *  一般来说都做一些资源释放工作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="comment">/*页面渲染完毕,但是还没有给浏览器响应数据的时候*/</span></span><br><span class="line">System.out.println(<span class="string">&quot;MyInterceptor afterCompletion&quot;</span>);</span><br><span class="line">System.out.println(ex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5、其他注解"><a href="#5、其他注解" class="headerlink" title="5、其他注解"></a>5、其他注解</h2><h3 id="5-1-PostMapping"><a href="#5-1-PostMapping" class="headerlink" title="5.1 @PostMapping"></a>5.1 @PostMapping</h3><ul><li>作用：指定当前发送请求的方式只可以是<code>post</code>请求</li><li>属性：和<code>@RequestMapping</code>中属性一致</li></ul><h3 id="5-2-GetMapping"><a href="#5-2-GetMapping" class="headerlink" title="5.2 @GetMapping"></a>5.2 @GetMapping</h3><ul><li>作用：指定当前发送请求的方式只可以是<code>get</code>请求</li><li>属性：和<code>@RequestMapping</code>中属性一致</li></ul><h3 id="5-3-JsonFormat"><a href="#5-3-JsonFormat" class="headerlink" title="5.3 @JsonFormat"></a>5.3 @JsonFormat</h3><ul><li>作用：处理响应json 数据的处理</li><li>属性：<ul><li>pattern ：指定响应时间日期的格式</li><li>Timezone：指定响应的时区，否则会有8个小时的时间差</li></ul></li></ul><h3 id="5-4-RequestBody"><a href="#5-4-RequestBody" class="headerlink" title="5.4 @RequestBody"></a>5.4 @RequestBody</h3><ul><li>作用：用于获取请求体<code>json</code>格式的字符串内容。直接使用得到是 <code>key=value&amp;key=value</code>结构的数据，<code>get </code>请求方式不适用。</li><li>属性：<code>required</code>：是否必须有请求体。默认值是:<code>true</code>。当取值为 <code>true </code>时，<code>get </code>请求方式会报错。如果取值 为 <code>false</code>，<code>get</code> 请求得到是<code>null</code>。</li></ul><h3 id="5-5-CrossOrigin"><a href="#5-5-CrossOrigin" class="headerlink" title="5.5 @CrossOrigin"></a>5.5 @CrossOrigin</h3><p>​<strong>跨域</strong>：出于浏览器的同源策略限制。同源策略（<code>SameOriginPolicy</code>）是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，则浏览器的正常功能可能都会受到影响。可以说<code>Web</code>是构建在同源策略基础之上的，浏览器只是针对同源策略的一种实现。同源策略会阻止一个域的<code>javascript</code>脚本和另外一个域的内容进行交互。所谓同源（即指在同一个域）就是两个页面具有相同的协议（<code>protocol</code>），主机（<code>host</code>）和端口号（<code>port</code>） </p><ul><li><p>作用：解决ajax请求之间的跨域问题</p></li><li><p>属性：</p><ul><li>origins：允许可访问的域列表IP</li><li>maxAge：准备响应前的缓存持续的最大时间（以秒为单位）。</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CrossOrigin(origins = &quot;http://domain2.com&quot;, maxAge = 3600)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/account&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Account <span class="title function_">receive</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Springmvc学习&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Springmvc" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/Springmvc/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Springmvc" scheme="https://lyblog2022.github.io/tags/Springmvc/"/>
    
  </entry>
  
  <entry>
    <title>Spring</title>
    <link href="https://lyblog2022.github.io/2022/06/04/study/Spring/"/>
    <id>https://lyblog2022.github.io/2022/06/04/study/Spring/</id>
    <published>2022-06-04T08:59:55.000Z</published>
    <updated>2022-06-06T04:53:58.000Z</updated>
    
    <content type="html"><![CDATA[<p>Spring学习</p><span id="more"></span><h2 id="1、Spring框架"><a href="#1、Spring框架" class="headerlink" title="1、Spring框架"></a>1、<code>Spring</code>框架</h2><h3 id="1-1-Spring框架"><a href="#1-1-Spring框架" class="headerlink" title="1.1 Spring框架"></a>1.1 <code>Spring</code>框架</h3><p>​<code>Spring</code>框架是由于软件开发的复杂性而创建的。<code>Spring</code>使用的是基本的<code>JavaBean</code>来完成以前只可能由<code>EJB</code>完成的事情。然而，<code>Spring</code>的用途不仅仅限于服务器端的开发。从简单性、可测试性和松耦合性角度而言，绝大部分<code>Java</code>应用都可以从<code>Spring</code>中受益。</p><p>​—-百度百科</p><ul><li>目的：解决企业应用开发的复杂性</li><li>功能：使用基本的<code>JavaBean</code>代替<code>EJB</code>，并提供更对的企业应用功能</li><li>范围：任何<code>Java</code>应用</li></ul><p>​<code>Spring</code>是分层的全栈式的轻量级开发框架，以<code>IOC</code>和<code>AOP</code>为核心</p><h3 id="1-2-优点"><a href="#1-2-优点" class="headerlink" title="1.2 优点"></a>1.2 优点</h3><ol><li>方便解耦，简化开发</li></ol><p><code>Spring</code>通过容器，将对象的创建从代码中剥离出来，交给<code>Spring</code>控制，避免直接编码造成模块之间的耦合度高，用户也不必自己编码处理对象的单例和多例控制，主要关注接口功能即可，不用关注具体使用哪个实现类和实现细节问题 </p><ol start="2"><li><code>AOP</code>切面编程</li></ol><p><code>AOP</code>切面编程是程序设计的一种概念，<code>Spring</code>对该概念实现的比较好，通过切面编程我们可以在不修改原有代码的情况下实现功能的增加，通常用于事务控制、日志记录、性能检测、权限控制等等</p><ol start="3"><li>声明式事务</li></ol><p>事务的控制可以托管给<code>Spring</code>，我们通过注解或者配置文件声明事务的处理方式即可，不用我们自己去编码处理</p><ol start="4"><li>整合<code>JUNIT</code>，方便测试</li></ol><p><code>spring</code>整合<code>JUNIT</code>单元测试，对于项目的功能都可以进行轻松快速的测试，便于我们调试程序</p><ol start="5"><li>方便整合各种优秀的框架</li><li>丰富的功能封装</li></ol><p><code>spring</code>对<code>JAVAEE</code>(<code>JDBC </code>，<code>JAVAMail</code>)都进行了一系列的封装，简化我们对于<code>API</code>的使用，提高程序的开发效率</p><ol start="7"><li>规范的源码学习样本</li></ol><p><code>spring</code>的源码设计巧妙，结构清晰，大量使用了设计模式，是<code>java</code>代码规范编写的典范</p><h2 id="2、Spring模块"><a href="#2、Spring模块" class="headerlink" title="2、Spring模块"></a>2、<code>Spring</code>模块</h2><img src="/2022/06/04/study/Spring/Spring%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png" class="" title="Spring体系结构 image"><h3 id="2-1-Data-Access-Integration（数据访问／集成）"><a href="#2-1-Data-Access-Integration（数据访问／集成）" class="headerlink" title="2.1 Data Access/Integration（数据访问／集成）"></a>2.1 <code>Data Access/Integration</code>（数据访问／集成）</h3><p>数据访问&#x2F;集成层包括 <code>JDBC</code>、<code>ORM</code>、<code>OXM</code>、JMS<code> </code>和 <code>Transactions </code>模块</p><ul><li><p><code>JDBC </code>模块：提供了一个 <code>JDBC </code>的抽象层，大幅度减少了在开发过程中对数据库操作的编码。</p></li><li><p><code>ORM </code>模块：对流行的对象关系映射 <code>API</code>，包括 <code>JPA</code>、<code>JDO</code>、<code>Hibernate</code>和 <code>iBatis </code>提供了的集成层。</p></li><li><p><code>OXM </code>模块：提供了一个支持对象<code>XML </code>映射的抽象层实现，如 <code>JAXB</code>、<code>Castor</code>、<code>XMLBeans</code>、<code>JiBX </code>和 <code>XStream</code>。 </p></li><li><p><code>JMS </code>模块：指<code>JAVA</code>消息服务，包含的功能为生产和消费的信息。</p></li><li><p><code>Transactions </code>事务模块：支持编程和声明式事务管理实现特殊接口类，并为所有的 <code>POJO</code>。</p></li></ul><h3 id="2-2-Web-模块"><a href="#2-2-Web-模块" class="headerlink" title="2.2  Web 模块"></a>2.2  <code>Web </code>模块</h3><p><code>Spring </code>的 <code>Web </code>层包括 <code>Web</code>、<code>Servlet</code>、<code>Struts </code>和 <code>Portlet </code>组件</p><ul><li><code>Web </code>模块：提供了基本的 <code>Web </code>开发集成特性，例如多文件上传功能、使用的 <code>Servlet </code>监听器的 <code>IoC </code>容器初始化以及 <code>Web </code>应用上下文。</li><li><code>Servlet</code>模块：包括 <code>Spring </code>模型—视图—控制器（<code>MVC</code>）实现 <code>Web</code>应用程序。</li><li><code>Struts </code>模块：包含支持类内的 <code>Spring </code>应用程序，集成了经典的 <code>Struts Web</code> 层。</li><li><code>Portlet </code>模块：提供了在 <code>Portlet </code>环境中使用 <code>MVC</code>实现，类似 <code>Web-Servlet</code> 模块的功能。</li></ul><h3 id="2-3-Core-Container（核心容器）"><a href="#2-3-Core-Container（核心容器）" class="headerlink" title="2.3 Core Container（核心容器）"></a>2.3 <code>Core Container</code>（核心容器）</h3><p><code>Spring </code>的核心容器是其他模块建立的基础，由 <code>Beans </code>模块、<code>Core </code>核心模块、<code>Context </code>上下文模块和 <code>Expression Language</code> 表达式语言模块组成</p><ul><li><code>Beans </code>模块：提供了 <code>BeanFactory</code>，是工厂模式的经典实现，<code>Spring </code>将管理对象称为 <code>Bean</code>。</li><li><code>Core </code>核心模块：提供了 <code>Spring </code>框架的基本组成部分，包括 <code>IoC </code>和 <code>DI </code>功能。</li><li><code>Context </code>上下文模块：建立在核心和 <code>Beans</code> 模块的基础之上，它是访问定义和配置任何对象的媒介。<code>ApplicationContext </code>接口是上下文模块的焦点。</li><li><code>Expression Language</code> 模块：是运行时查询和操作对象图的强大的表达式语言。</li></ul><h3 id="2-4-其他模块"><a href="#2-4-其他模块" class="headerlink" title="2.4 其他模块"></a>2.4 其他模块</h3><p><code>Spring</code>的其他模块还有 <code>AOP</code>、<code>Aspects</code>、<code>Instrumentation </code>以及 <code>Test </code>模块</p><ul><li><code>AOP </code>模块：提供了面向切面编程实现，允许定义方法拦截器和切入点，将代码按照功能进行分离，以降低耦合性。</li><li><code>Aspects </code>模块：提供与 <code>AspectJ </code>的集成，是一个功能强大且成熟的面向切面编程（<code>AOP</code>）框架。</li><li><code>Instrumentation </code>模块：提供了类工具的支持和类加载器的实现，可以在特定的应用服务器中使用。</li><li><code>Test </code>模块：支持 <code>Spring </code>组件，使用 <code>JUnit </code>或 <code>TestNG </code>框架的测试。</li></ul><h2 id="3、Spring-IOC"><a href="#3、Spring-IOC" class="headerlink" title="3、Spring_IOC"></a>3、Spring_IOC</h2><h3 id="3-1-控制反转"><a href="#3-1-控制反转" class="headerlink" title="3.1 控制反转"></a>3.1 控制反转</h3><p>​控制反转（Inversion of Control，缩写为<strong>IoC</strong>），是面向对象编程中的一种设计原则，可以用来减低计算机代码之间的耦合度。其中最常见的方式叫做<strong>依赖注入</strong>（Dependency Injection，简称<strong>DI</strong>），还有一种方式叫<strong>依赖查找</strong>（Dependency Lookup）。通过控制反转，对象在被创建的时候，由一个调控系统内所有对象的外界实体将其所依赖的对象的引用传递给它。也可以说，依赖被注入到对象中。–【百度】</p><p>​简单来说，创建对象的权利，或者是控制的位置，由<code>Java</code>代码转移到<code>Spring</code>容器，由<code>Spring</code>的容器控制对象的创建，就是控制反转，<code>Spring</code>创建对象时，会读取配置文件中的信息，然后使用反射创建好的对象之后在容器中存储起来，当需要某个对象时，通过<code>id</code>获取对象即可，不需要自己去<code>new</code></p><h3 id="3-2-原理分析"><a href="#3-2-原理分析" class="headerlink" title="3.2 原理分析"></a>3.2 原理分析</h3><h4 id="3-2-1-XML解析"><a href="#3-2-1-XML解析" class="headerlink" title="3.2.1 XML解析"></a>3.2.1 XML解析</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;stuDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.dao.impl.StuDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>​将上面的信息读取进入程序  对象的ID ,一个是对象的类的全路径名</p><h4 id="3-2-2-反射"><a href="#3-2-2-反射" class="headerlink" title="3.2.2 反射"></a>3.2.2 反射</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获得类的字节码</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span>Class.forName(<span class="string">&quot;com.dao.impl.StuDaoImpl&quot;</span>);</span><br><span class="line"><span class="comment">//通过字节码实例化对象</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span>  <span class="operator">=</span> clazz.newInstance(); </span><br><span class="line"><span class="comment">//将对象放到一个map集合中</span></span><br><span class="line">map.put(<span class="string">&quot;empDao&quot;</span>,obj)</span><br></pre></td></tr></table></figure><h4 id="3-2-3-工厂模式"><a href="#3-2-3-工厂模式" class="headerlink" title="3.2.3 工厂模式"></a>3.2.3 工厂模式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span>&#123; </span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>map.get(name); </span><br><span class="line">    <span class="keyword">return</span> obj; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>IOC</code>接口</p><ul><li><code>BeanFactory </code>接口：<code>IOC</code>容器基本功能接口，是<code>spring</code>内部使用的接口，我们在处理业务时一般不直接使用该接口</li><li><code>ApplicationContext </code>接口：<code>BeanFactory</code>的子接口，提供更多更强大的功能，研发人员一般使用的接口</li></ul><img src="/2022/06/04/study/Spring/spring2.png" class="" title="spring2 image"><h2 id="4、Spring-XML方式实现DI"><a href="#4、Spring-XML方式实现DI" class="headerlink" title="4、Spring_XML方式实现DI"></a>4、<code>Spring_XML</code>方式实现<code>DI</code></h2><p><code>spring</code>中的<code>Bean</code>的管理: </p><p><code>Bean</code>(汉译咖啡豆)，又称<code>JAVABean</code>，其实就是<code>JAVA</code>程序程序中的一个个对象，所以<code>Bean</code>的管理其实就是<code>spring</code>对于<code>JAVA</code>程序中的对象的管理</p><p>管理的内容</p><ul><li>对象的创建（<code>IOC</code>）：控制反转，就是<code>Spring</code>给我们创建对象，然后我们直接用，不用自己<code>NEW</code></li><li>属性的赋值（<code>DI</code>）：依赖注入，即创建属性时给对象属性赋值，对象功能的实现往往要依赖属性的值，由于对象属性不仅仅是基本数据类型，还可能是其他类或者引用类型，那么依赖注入将会把更多的对象之间的关系整理到一起，可以形成一个庞大的依赖关系，DI处理的是对象的属性赋值和互相依赖的关系</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过无参构造方法构造对象--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bean.User&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user1&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> <span class="attr">lazy-init</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">id:对象的id</span></span><br><span class="line"><span class="comment">class:类的全路径名</span></span><br><span class="line"><span class="comment">name:和id类似,一般不用</span></span><br><span class="line"><span class="comment">scope：控制对象单例多例和使用范围</span></span><br><span class="line"><span class="comment">singleton：作用域(scope 默认值), Spring IOC容器中只会存在一个共享的bean实例</span></span><br><span class="line"><span class="comment">prototype：作用域部署的bean，每一次获取都会产生一个新的bean实例，相当与一个new的操作</span></span><br><span class="line"><span class="comment">request：表示该针对每一次HTTP请求都会产生一个新的bean，同时该bean仅在当前HTTP request内有效</span></span><br><span class="line"><span class="comment">session：作用域表示该针对每一次HTTP请求都会产生一个新的bean，同时该bean仅在当前HTTP session内有效</span></span><br><span class="line"><span class="comment">global session：作用域类似于标准的HTTP Session作用域，不过它仅仅在基于portlet的web应用中才有意义</span></span><br><span class="line"><span class="comment">lazy-init：懒加载 调用getBean的时候再去实例化对象</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--通过set方法给对象属性赋值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bean.User&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;abcdefg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--通过有参构造给对象属性赋值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bean.User&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小明&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456789&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--特殊符号--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.bean.User&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--null值--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userid&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">null</span>&gt;</span><span class="tag">&lt;/<span class="name">null</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--特殊符号 转译字符 &lt; &amp;lt;  &gt;&amp;gt;  &amp; &amp;amp;     --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;<span class="symbol">&amp;amp;</span>xiaoming<span class="symbol">&amp;lt;</span><span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 特殊符号  &lt;![CDATA[内容]]&gt;  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[&amp;&lt;123456&gt;]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5、Spring-Bean生命周期"><a href="#5、Spring-Bean生命周期" class="headerlink" title="5、Spring_Bean生命周期"></a>5、<code>Spring_Bean</code>生命周期</h2><ol><li>通过构造器创建bean实例&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  执行构造器</li><li>为bean属性赋值&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;  执行set方法</li><li>初始化bean&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 调用bean的初始化方法,需要配置指定调用的方法</li><li>bean的获取&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 容器对象 getBean方法</li><li>容器关闭销毁bean&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; 调用销毁方法,需要配置指定调用的方法</li></ol><h2 id="6、Spring注解方式管理Bean"><a href="#6、Spring注解方式管理Bean" class="headerlink" title="6、Spring注解方式管理Bean"></a>6、<code>Spring</code>注解方式管理<code>Bean</code></h2><h3 id="6-1-注解方式创建对象IOC"><a href="#6-1-注解方式创建对象IOC" class="headerlink" title="6.1 注解方式创建对象IOC"></a>6.1 注解方式创建对象<code>IOC</code></h3><ul><li>@Component：放在类上,用于标记，告诉<code>spring</code>当前类需要由容器实例化<code>bean</code>并放入容器中</li><li>@Controller：@Component子注解，用于实例化<code>controller</code>层<code>bean</code></li><li>@Service：@Component子注解，用于实例化<code>service</code>层<code>bean</code></li><li>@Repository：@Component子注解，用于实例化持久层<code>bean</code></li></ul><h3 id="6-2-注解方式依赖注入DI"><a href="#6-2-注解方式依赖注入DI" class="headerlink" title="6.2 注解方式依赖注入DI"></a>6.2 注解方式依赖注入<code>DI</code></h3><ul><li>@Autowired：根据属性数据类型自动装配</li><li>@Qualifier：根据属性名称注入依赖</li><li>@Resources：可以根据类型,也可以根据名称注入</li><li>@Value：注入普通数据类型(8+String)</li></ul><h2 id="7、Spring代理"><a href="#7、Spring代理" class="headerlink" title="7、Spring代理"></a>7、<code>Spring</code>代理</h2><h3 id="7-1-代理模式"><a href="#7-1-代理模式" class="headerlink" title="7.1 代理模式"></a>7.1 代理模式</h3><p>通过代理对象访问目标对象，可以在目标对象基础上增强额外的功能，如添加权限、访问控制等</p><img src="/2022/06/04/study/Spring/spring%E4%BB%A3%E7%90%86.png" class="" title="spring代理 image"><h3 id="7-2-静态代理"><a href="#7-2-静态代理" class="headerlink" title="7.2 静态代理"></a>7.2 静态代理</h3><p>​静态代理中代理类与被代理类都需要实现同一个接口，即一个静态代理类只能代理一个类，并且需要知道要代理哪个类才能编写代理类代码，如果有其他类想要使用代理类，就必须再写一个</p><p>​在实际开发中是可能有非常多的类需要被代理，并且可能并不知道要代理哪个类，所以继续使用静态代理反而会增加更多的工作量，且效率低下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Author</span>: Ly</span></span><br><span class="line"><span class="comment">* <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">Court court=<span class="keyword">new</span> <span class="title class_">Lawyer</span>(person);</span><br><span class="line">court.doCourt();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Court</span>&#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">doCourt</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lawyer</span> <span class="keyword">implements</span> <span class="title class_">Court</span>&#123;</span><br><span class="line"><span class="keyword">private</span> Person person;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Lawyer</span><span class="params">(Person person)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.person = person;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCourt</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;律师取证:视频证明张三当时正在旅游,不在案发现场&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;律师总结:张三不可能去杀人&quot;</span>);</span><br><span class="line">person.doCourt();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被代理的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Court</span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCourt</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(name+<span class="string">&quot;说:我没有杀人&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="7-3-动态代理"><a href="#7-3-动态代理" class="headerlink" title="7.3 动态代理"></a>7.3 动态代理</h3><p>​动态代理可以针对于一些不特定的类或者一些不特定的方法进行代理，可以在程序运行时动态的改变代理的规则，代理类在程序运行时才创建的代理模式，在这种情况下，代理类并不是在<code>Java</code>代码中定义好，而是在程序运行时根据在<code>Java</code>代码中的指示动态生成的</p><ul><li><code>Proxy</code>动态代理：<code>JDK</code>动态代理，面向接口</li><li><code>cglib</code>动态代理：第三方动态代理，面向父类</li></ul><h4 id="7-3-1-Proxy动态代理"><a href="#7-3-1-Proxy动态代理" class="headerlink" title="7.3.1 Proxy动态代理"></a>7.3.1 <code>Proxy</code>动态代理</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testProxy;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">Dinner dinner=<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过Porxy动态代理获得一个代理对象,在代理对象中,对某个方法进行增强</span></span><br><span class="line"><span class="comment">// ClassLoader loader,被代理的对象的类加载器</span></span><br><span class="line"><span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> dinner.getClass().getClassLoader();</span><br><span class="line"><span class="comment">// Class&lt;?&gt;[] interfaces,被代理对象所实现的所有接口</span></span><br><span class="line">Class[] interaces= dinner.getClass().getInterfaces();</span><br><span class="line"><span class="comment">//InvocationHandler h,执行处理器对象,专门用于定义增强的规则</span></span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line"><span class="comment">// invoke 当我们让代理对象调用任何方法时,都会触发invoke方法的执行</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"><span class="comment">//Object proxy, 代理对象</span></span><br><span class="line"><span class="comment">//Method method,被代理的方法</span></span><br><span class="line"><span class="comment">//Object[] args,被代理方法运行时的实参</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">res</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;eat&quot;</span>)) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;饭前洗手&quot;</span>);</span><br><span class="line"><span class="comment">// 让原有的eat的方法去运行</span></span><br><span class="line">res = method.invoke(dinner, args);</span><br><span class="line">System.out.println(<span class="string">&quot;饭后刷碗&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 如果是其他方法,那么正常执行就可以了</span></span><br><span class="line">res = method.invoke(dinner, args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">Dinner</span> <span class="variable">dinnerProxy</span> <span class="operator">=</span>(Dinner) Proxy.newProxyInstance(classLoader,interaces,handler);</span><br><span class="line"><span class="comment">//dinnerProxy.eat(&quot;包子&quot;);</span></span><br><span class="line">dinnerProxy.drink();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Dinner</span>&#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(String foodName)</span>;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">drink</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Dinner</span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(String foodName)</span> &#123;</span><br><span class="line">System.out.println(name+<span class="string">&quot;正在吃&quot;</span>+foodName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drink</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(name+<span class="string">&quot;正在喝茶&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Dinner</span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(String foodName)</span> &#123;</span><br><span class="line">System.out.println(name+<span class="string">&quot;正在食堂吃&quot;</span>+foodName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drink</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(name+<span class="string">&quot;正在喝可乐&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​总结：</p><ul><li>在不修改原有代码的或者没有办法修改原有代码的情况下，增强对象功能使用代理对象代替原来的对象去完成功能，进而达到拓展功能的目的</li><li><code>JDK Proxy</code>动态代理是面向接口的动态代理，一定要有接口和实现类，代理对象增强的是实现类，在实现接口的方法重写方法，生成的代理对象只能转换成接口，不能转换成代理类<ul><li>生成的代理对象只能转换成接口，不能转换成被代理类</li><li>代理对象只能增强接口中定义的方法，实现类中其他和接口无关的方法是无法增强的</li><li>代理对象只能读取到接口中方法上的注解，不能读取到实现类方法上的注解</li></ul></li></ul><h4 id="7-3-2-cglib动态代理模式"><a href="#7-3-2-cglib动态代理模式" class="headerlink" title="7.3.2 cglib动态代理模式"></a>7.3.2 <code>cglib</code>动态代理模式</h4><img src="/2022/06/04/study/Spring/cglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.png" class="" title="cglib动态代理 image"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testCglib; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodProxy; </span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCglib</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="comment">// 获取一个Person的代理对象</span></span><br><span class="line"><span class="comment">// 1 获得一个Enhancer对象</span></span><br><span class="line"><span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line"><span class="comment">// 2 设置父类字节码</span></span><br><span class="line">enhancer.setSuperclass(person.getClass());</span><br><span class="line"><span class="comment">// 3 获取MethodIntercepter对象 用于定义增强规则</span></span><br><span class="line"><span class="type">MethodInterceptor</span> <span class="variable">methodInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"><span class="comment">/*  Object o,  生成之后的代理对象 personProxy</span></span><br><span class="line"><span class="comment">Method method,  父类中原本要执行的方法  Person&gt;&gt;&gt; eat()</span></span><br><span class="line"><span class="comment">Object[] objects, 方法在调用时传入的实参数组</span></span><br><span class="line"><span class="comment">MethodProxy methodProxy  子类中重写父类的方法 personProxy &gt;&gt;&gt; eat()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">res</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;eat&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">// 如果是eat方法 则增强并运行</span></span><br><span class="line">System.out.println(<span class="string">&quot;饭前洗手&quot;</span>);</span><br><span class="line">res = methodProxy.invokeSuper(o,objects);</span><br><span class="line">System.out.println(<span class="string">&quot;饭后刷碗&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 如果是其他方法 不增强运行</span></span><br><span class="line">res = methodProxy.invokeSuper(o,objects); <span class="comment">// 子类对象方法在执行,默认会调用父类对应被重写的方法</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 4 设置methodInterceptor</span></span><br><span class="line">enhancer.setCallback(methodInterceptor);</span><br><span class="line"><span class="comment">// 5 获得代理对象</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">personProxy</span> <span class="operator">=</span> (Person)enhancer.create();</span><br><span class="line"><span class="comment">// 6 使用代理对象完成功能</span></span><br><span class="line">personProxy.eat(<span class="string">&quot;包子&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>  &#123;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(String foodName)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;张三正在吃&quot;</span>+foodName);</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="8、Spring-AOP"><a href="#8、Spring-AOP" class="headerlink" title="8、Spring AOP"></a>8、<code>Spring AOP</code></h2><h3 id="8-1-AOP-概念及原理"><a href="#8-1-AOP-概念及原理" class="headerlink" title="8.1 AOP 概念及原理"></a>8.1 <code>AOP </code>概念及原理</h3><p>​在软件业，<code>AOP</code>为<code>Aspect Oriented Programming</code>的缩写，意为：面向切面编程，通过预编译方式和运行期间动态代理实现程序功能的统一维护的一种技术。<code>AOP</code>是<code>OOP</code>的延续，是软件开发中的一个热点，也是<code>Spring</code>框架中的一个重要内容，是函数式编程的一种衍生范型。利用<code>AOP</code>可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。—-【百度百科】</p><p>​<code>AOP </code>面向切面编程一般可以在不修改现有代码的情况下，对程序功能进行拓展，往往用于实现日志处理、权限控制、性能检测、事务控制等</p><p>​AOP实现的原理就是<strong>动态代理</strong>，在有接口的情况下，使用**<code>JDK</code>动态代理<strong>，在没有接口的情况下使用</strong><code>cglib</code>动态代理**</p><h3 id="8-2-术语"><a href="#8-2-术语" class="headerlink" title="8.2 术语"></a>8.2 术语</h3><ol><li>连接点（<code>Joint point</code>）：类里面可以被增强的方法，这些方法称之为<strong>连接点</strong>，表示在程序中明确定义的点，典型的包括方法调用，对类成员的访问以及异常处理程序块的执行等待，它自身还可以嵌套其他<code>Join point</code></li><li>切入点（<code>Pointcut</code>）：实际被增强的方法，称之为切入点，表示一组<code>joint point</code>，这些<code>joint point</code>或是通过逻辑关系组合起来，或是通过通配、正则表达式等方式集中起来，它定义了相应的<code>Advince</code>将要发生的地方</li><li>通知（<code>Advince</code>）：实际增强的逻辑部分称为通知（增加的功能），<code>Advince</code>定义了在<code>Pointcut</code>里面定义的程序点具体要做的操作，它通过<code>before</code>、<code>after</code>、<code>around</code>来区别是在每个<code>joint point</code>之前、之后还是代替执行的代码，通知类型：前置通知、后置通知、环绕通知、异常通知、最终通知</li><li>目标对象（<code>Target</code>）：被增强功能的对象（被代理的对象）</li><li>切面（<code>Aspect</code>）：表现为功能相关的一些advice放在一起声明成为一个<code>java</code>类，<code>aspect</code>声明类似与<code>java</code>的类声明，在<code>aspect</code>中会包含一些<code>pointcut</code>以及相应的<code>advince</code></li><li>织入（<code>Weaving</code>）：创建代理对象并实现功能增强的声明并运行的过程，将<code>Aspect</code>和其他对象链接起来，并创建<code>Advince Object</code>的过程</li></ol><h3 id="8-3-注解方式实现"><a href="#8-3-注解方式实现" class="headerlink" title="8.3 注解方式实现"></a>8.3 注解方式实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.aspect;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: Ly</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoAspect</span> &#123;</span><br><span class="line">    <span class="comment">//定义公共切点</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.dao.*.add*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addPointCut</span><span class="params">()</span> &#123;&#125;. </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 前置通知: 切点方法执行之前先执行的功能</span></span><br><span class="line"><span class="comment">    * 参数列表可以用JoinPoint接收切点对象</span></span><br><span class="line"><span class="comment">    * 可以获取方法执行的参数</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Before(&quot;addPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before invoked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 后置通知:方法执行之后要增强的功能</span></span><br><span class="line"><span class="comment">    * 无论切点方法是否出现异常都会执行的方法</span></span><br><span class="line"><span class="comment">    * 参数列表可以用JoinPoint接收切点对象</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@After(&quot;addPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodAfter</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;After invoked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 返回通知:切点方法正常运行结束后增强的功能</span></span><br><span class="line"><span class="comment">     * 如果方法运行过程中出现异常,则该功能不运行</span></span><br><span class="line"><span class="comment">     * 参数列表可以用 JoinPoint joinPoint接收切点对象</span></span><br><span class="line"><span class="comment">     * 可以用Object res接收方法返回值,需要用returning指定返回值名称</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="meta">@AfterReturning( value = &quot;addPointCut()&quot;,returning = &quot;res&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodAfterReturning</span><span class="params">(JoinPoint joinPoint, Object res)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterReturning invoked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 异常通知:切点方法出现异常时运行的增强功能</span></span><br><span class="line"><span class="comment">     * 如果方法运行没有出现异常,则该功能不运行</span></span><br><span class="line"><span class="comment">     * 参数列表可以用Exception ex接收异常对象 需要通过throwing指定异常名称</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="meta">@AfterThrowing( value = &quot;addPointCut()&quot;,throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodAfterThrowing</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;AfterThrowing invoked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/*环绕通知:在切点方法之前和之后都进行功能的增强</span></span><br><span class="line"><span class="comment">    * 需要在通知中定义方法执行的位置,并在执行位置之前和之后自定义增强的功能</span></span><br><span class="line"><span class="comment">    * 方法列表可以通过ProceedingJoinPoint获取执行的切点</span></span><br><span class="line"><span class="comment">    * 通过proceedingJoinPoint.proceed()方法控制切点方法的执行位置</span></span><br><span class="line"><span class="comment">    * proceedingJoinPoint.proceed()方法会将切点方法的返回值获取到,并交给我们,可以做后续处理</span></span><br><span class="line"><span class="comment">    * 我们在环绕通知的最后需要将切点方法的返回值继续向上返回,否则切点方法在执行时接收不到返回值</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="meta">@Around(&quot;addPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">methodAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;aroundA invoked&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;aroundB invoked&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​有多个增强类对同一个方法进行增强，通过<code>@Order</code>注解设置增强类优先级，数字越小，优先级越高，数字越小，其代理位置越靠近注入位置</p><h2 id="9、Spring-事务"><a href="#9、Spring-事务" class="headerlink" title="9、Spring 事务"></a>9、<code>Spring </code>事务</h2><h3 id="9-1-事务"><a href="#9-1-事务" class="headerlink" title="9.1 事务"></a>9.1 事务</h3><p>​事务（<code>Transaction</code>）：指的是一个操作序列，该操作序列中的多个操作，只能都做，或者都不做，是一个不可分割的工作单位，是数据库环境中的逻辑工作单位，由<code>DBMS</code>中的事务管理子系统负责事务的处理</p><p>​但并不是所有的操作序列都可以称为为事务，因为一个操作序列成为事务，必须满足事务的四个特性，即原子性（<code>Atomicity</code>）、一致性（<code>Consistency</code>）、隔离性（<code>Isolation</code>）、持久性（<code>Durability</code>）&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;<code>ACID</code>特性</p><h4 id="9-1-1-原子性"><a href="#9-1-1-原子性" class="headerlink" title="9.1.1 原子性"></a>9.1.1 原子性</h4><p>​原子是自然界最小的颗粒，具有不可再分的特性。事务中的所有操作可以看做一个原子，事务是应用中不可再分的最小的逻辑执行体。</p><p>​使用事务对数据进行修改的操作序列，要么全部执行，要么全不执行。通常，某个事务中的操作都具有共同的目标，并且是相互依赖的。如果数据库系统只执行这些操作中的一部分，则可能会破坏事务的总体目标，而原子性消除了系统只处理部分操作的可能性。</p><h4 id="9-1-2-一致性"><a href="#9-1-2-一致性" class="headerlink" title="9.1.2 一致性"></a>9.1.2 一致性</h4><p>​一致性是指事务执行的结果必须使数据库从一个一致性状态，变到另一个一致性状态。当数据库中只包含事务成功提交的结果时，数据库处于一致性状态。一致性是通过原子性来保证的。</p><p>​例如：在转账时，只有保证转出和转入的金额一致才能构成事务。也就是说事务发生前和发生后，数据的总额依然匹配。</p><h4 id="9-1-3-隔离性"><a href="#9-1-3-隔离性" class="headerlink" title="9.1.3 隔离性"></a>9.1.3 隔离性</h4><p>​隔离性是指各个事务的执行互不干扰，任意一个事务的内部操作对其他并发的事务，都是隔离的。也就是说：并发执行的事务之间既不能看到对方的中间状态，也不能相互影响。</p><p>​例如：在转账时，只有当A账户中的转出和B账户中转入操作都执行成功后才能看到A账户中的金额减少以及B账户中的金额增多。并且其他的事务对于转账操作的事务是不能产生任何影响的。</p><h4 id="9-1-4-持久性"><a href="#9-1-4-持久性" class="headerlink" title="9.1.4 持久性"></a>9.1.4 持久性</h4><p>​持久性指事务一旦提交，对数据所做的任何改变，都要记录到永久存储器中，通常是保存进物理数据库，即使数据库出现故障，提交的数据也应该能够恢复。但如果是由于外部原因导致的数据库故障，如硬盘被损坏，那么之前提交的数据则有可能会丢失。</p><h3 id="9-2-事务的并发问题"><a href="#9-2-事务的并发问题" class="headerlink" title="9.2 事务的并发问题"></a>9.2 事务的并发问题</h3><h4 id="9-2-1-脏读（Dirty-read）"><a href="#9-2-1-脏读（Dirty-read）" class="headerlink" title="9.2.1 脏读（Dirty read）"></a>9.2.1 脏读（<code>Dirty read</code>）</h4><p>​当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</p><h4 id="9-2-2-不可重复读（Unrepeatableread）"><a href="#9-2-2-不可重复读（Unrepeatableread）" class="headerlink" title="9.2.2 不可重复读（Unrepeatableread）"></a>9.2.2 不可重复读（<code>Unrepeatableread</code>）</h4><p>​ 指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</p><h4 id="9-2-3-幻读（Phantom-read）"><a href="#9-2-3-幻读（Phantom-read）" class="headerlink" title="9.2.3 幻读（Phantom read）"></a>9.2.3 幻读（<code>Phantom read</code>）</h4><p>​幻读与不可重复读类似。它发生在一个事务（<code>T1</code>）读取了几行数据，接着另一个并发事务（<code>T2</code>）插入了一些数据时。在随后的查询中，第一个事务（<code>T1</code>）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。</p><h4 id="9-2-4-总结"><a href="#9-2-4-总结" class="headerlink" title="9.2.4 总结"></a>9.2.4 总结</h4><p>​不可重复读的重点是修改，幻读的重点在于新增或者删除</p><p>​解决不可重复读的问题只需要锁住满足条件的行，解决幻读需要锁表</p><h4 id="9-2-5-事务的隔离级别"><a href="#9-2-5-事务的隔离级别" class="headerlink" title="9.2.5 事务的隔离级别"></a>9.2.5 事务的隔离级别</h4><p>​事务的隔离级别用于决定如何控制并发用户读写数据的操作。数据库是允许多用户并发访问的，如果多个用户同时开启事务并对同一数据进行读写操作的话，有可能会出现脏读、不可重复读和幻读问题，所以<code>MySQL</code>中提供了四种隔离级别来解决上述问题。 </p><p>​事务的隔离级别从低到高依次为<code>READ UNCOMMITTED</code>、<code>READ COMMITTED</code>、<code>REPEATABLE READ</code>以及<code>SERIALIZABLE</code>，隔离级别越低，越能支持高并发的数据库操作。</p><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td>READ UNCOMMITTED（读未提交）</td><td>true</td><td>true</td><td>true</td></tr><tr><td>READ COMMITTED（读已提交）</td><td>false</td><td>true</td><td>true</td></tr><tr><td>REPEATABLE READ（可重复读）</td><td>false</td><td>false</td><td>true</td></tr><tr><td>SERIALIZABLE（串行化）</td><td>false</td><td>false</td><td>false</td></tr></tbody></table><p>​</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Spring学习&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Spring" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/Spring/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="Spring" scheme="https://lyblog2022.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Servlet</title>
    <link href="https://lyblog2022.github.io/2022/06/04/study/Servlet/"/>
    <id>https://lyblog2022.github.io/2022/06/04/study/Servlet/</id>
    <published>2022-06-04T08:59:30.000Z</published>
    <updated>2022-06-04T10:16:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>Servlet学习</p><span id="more"></span><h3 id="1、Servlet的继承结构"><a href="#1、Servlet的继承结构" class="headerlink" title="1、Servlet的继承结构"></a>1、Servlet的继承结构</h3><img src="/2022/06/04/study/Servlet/servlet%E7%BB%A7%E6%89%BF%E7%BB%93%E6%9E%84.png" class="" title="This is an example image"><h3 id="2、Servlet接口"><a href="#2、Servlet接口" class="headerlink" title="2、Servlet接口"></a>2、Servlet接口</h3><ul><li>init()：创建servlet对象后立即调用该方法完成其他初始化工作</li><li>service()：处理客户端请求，执行业务操作，利用响应对象响应客户端请求</li><li>destory()：再销毁servlet对象之前调用该方法，释放资源</li><li>getServletConfig()：ServletConfig 是容器向Servlet传递参数的载体</li><li>getServletInfo()：获取servlet相关信息</li></ul><h3 id="3、ServletConfig-接口"><a href="#3、ServletConfig-接口" class="headerlink" title="3、ServletConfig 接口"></a>3、ServletConfig 接口</h3><p>​Servlet运行期间，需要一些辅助信息，这些信息可以在web.xml文件中，使用一个或多个元素进行配置。当tomacat初始化一个servlet时，会将该servlet的配置信息，封装到ServletConfig对象中，通过调用init(ServletConfig servletConfig)方法，将ServletConfig对象传递给Servlet</p><h3 id="4、GenericServlet-抽象类"><a href="#4、GenericServlet-抽象类" class="headerlink" title="4、GenericServlet 抽象类"></a>4、GenericServlet 抽象类</h3><p>​GenericServlet是实现了Servlet接口的抽象类。在GenericServlet中进一步的定义了Servlet接口的具体实现，其设计的目的是为了和应用层协议解耦，再GenericServlet中包含了一个Service抽象方法，可以通过继承GenericServlet并实现Service方法实现请求的处理，但是需要将ServletRequest和ServletResponse 转化为HttpServletRequest和HttpServletResponse</p><h3 id="5、HttpServlet"><a href="#5、HttpServlet" class="headerlink" title="5、HttpServlet"></a>5、HttpServlet</h3><p>​继承自GenericServlet，针对于处理Http协议的请求定制，在HttpServlet的service()方法中已经把ServletRequest和ServletResponse 转化为HttpServletRequest和HttpServletResponse</p><h3 id="6、Servlet的生命周期"><a href="#6、Servlet的生命周期" class="headerlink" title="6、Servlet的生命周期"></a>6、Servlet的生命周期</h3><p>​servlet的生命周期是由容器管理的，分别经历4个阶段</p><table><thead><tr><th>阶段</th><th>字数</th><th>时机</th></tr></thead><tbody><tr><td>创建</td><td>1次</td><td>第一次请求之后</td></tr><tr><td>初始化</td><td>1次</td><td>实例化之后</td></tr><tr><td>执行服务</td><td>多次</td><td>每次请求</td></tr><tr><td>销毁</td><td>1次</td><td>停止服务、</td></tr></tbody></table><h3 id="7、注意事项"><a href="#7、注意事项" class="headerlink" title="7、注意事项"></a>7、注意事项</h3><ul><li>在Servlet中一般不要轻易使用成员变量，可能会造成线程安全问题</li><li>如果要使用，应尽量避免对成员变量产生修改</li><li>如果要产生修改，应注意线程安全问题</li></ul><h3 id="8、ServletContext对象和ServletConfig对象"><a href="#8、ServletContext对象和ServletConfig对象" class="headerlink" title="8、ServletContext对象和ServletConfig对象"></a>8、ServletContext对象和ServletConfig对象</h3><p>​ServletContext叫做Servlet上下文，服务器会为每一个web应用创建一个ServletContext对象，这个对象全局唯一，而且web应用中的所有Servlet都共享这个对象</p><h4 id="8-1、ServletContext对象的作用"><a href="#8-1、ServletContext对象的作用" class="headerlink" title="8.1、ServletContext对象的作用"></a>8.1、ServletContext对象的作用</h4><ul><li>相对路径转为绝对路径</li><li>获取容器的附加信息</li><li>读取配置</li><li>全局容器</li></ul><h4 id="8-2、ServletContext的生命周期"><a href="#8-2、ServletContext的生命周期" class="headerlink" title="8.2、ServletContext的生命周期"></a>8.2、ServletContext的生命周期</h4><p>​当容器启动时会创建ServletContext对象并一直缓存该对象，直到容器关闭后该对象生命周期结束，ServletContext的生命周期非常长，所以在使用全局容器时不建议存放业务数据</p><h4 id="8-3、ServletConfig对象"><a href="#8-3、ServletConfig对象" class="headerlink" title="8.3、ServletConfig对象"></a>8.3、ServletConfig对象</h4><p>​ServletConfig对象对应web.xml文件中的<Servlet>节点，当Tomcat初始化一个Servlet时，会将该Servlet的配置信息，封装到一个ServletConfig对象中，可以通过该对象读取<servlet>节点中的配置信息</p><h3 id="9、请求转发"><a href="#9、请求转发" class="headerlink" title="9、请求转发"></a>9、请求转发</h3><h4 id="9-1-forward转发"><a href="#9-1-forward转发" class="headerlink" title="9.1 forward转发"></a>9.1 forward转发</h4><h5 id="9-1-1-forward转发处理流程"><a href="#9-1-1-forward转发处理流程" class="headerlink" title="9.1.1 forward转发处理流程"></a>9.1.1 forward转发处理流程</h5><ol><li>清空response存放的正在响应正文数据缓冲区</li><li>如果目标资源为Servlet或jsp，就调用他们的service方法，把该方法产生的响应结果发送到客户端；如果目标资源是静态文件中的HTML，就读取文件中的数据把它发送到客户端</li></ol><h5 id="9-1-2-forward处理特点"><a href="#9-1-2-forward处理特点" class="headerlink" title="9.1.2 forward处理特点"></a>9.1.2 forward处理特点</h5><ol><li>由于forward()方法先清空用于存放相应正文的缓冲区，因此源Servlet生成的响应结果不会被发送到客户端，只有目标资源生成的响应结果才会被发送到客户端</li><li>如果源Servlet在进行请求转发之前，已经提交了响应结(flushBuffer()，close()方法)，那么forward()方法会抛出异常，为避免异常，不应该在源servlet中提交响应结果</li></ol><h4 id="9-2-include转发"><a href="#9-2-include转发" class="headerlink" title="9.2 include转发"></a>9.2 include转发</h4><h5 id="9-2-1-include处理流程"><a href="#9-2-1-include处理流程" class="headerlink" title="9.2.1 include处理流程"></a>9.2.1 include处理流程</h5><ol><li>如果目标资源为Servlet或者jsp，就调用他们的service方法，把该方法产生的响应正文添加到源Servlet的响应结果中；如果目标组建为HTML文档，就直接把文档的内容添加到源Servlet的响应结果中</li><li>返回到源Servlet的服务方法中，继续执行后续代码</li></ol><h5 id="9-2-2-include处理特点"><a href="#9-2-2-include处理特点" class="headerlink" title="9.2.2 include处理特点"></a>9.2.2 include处理特点</h5><ol><li>源Servlet与被包含的目标资源的输出数据都会被添加到响应结果中</li><li>在目标资源对响应状态码或者响应开头所做的修改都会被忽略</li></ol><h3 id="10、Cookie对象和HttpSession对象"><a href="#10、Cookie对象和HttpSession对象" class="headerlink" title="10、Cookie对象和HttpSession对象"></a>10、Cookie对象和HttpSession对象</h3><p>​Cookie对象和HttpSession对象的作用是维护客户端浏览器与服务端的会话状态的两个对象，二者的不同是Cookie是通过客户端浏览器实现会话的维持，而HttpSession是通过服务端来实现会话的维持</p><h4 id="10-1-区别"><a href="#10-1-区别" class="headerlink" title="10.1 区别"></a>10.1 区别</h4><ul><li>cookie数据存放在客户的浏览器或系统文件中，httpsession中的数据存放在服务器中</li><li>cookie不安全，httpSession是安全的</li><li>单个cookie保存的数据不能超过4K，httpSession无限制</li></ul><p></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Servlet学习&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="servlet" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/servlet/"/>
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="servlet" scheme="https://lyblog2022.github.io/tags/servlet/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis</title>
    <link href="https://lyblog2022.github.io/2022/06/04/study/MyBatis/"/>
    <id>https://lyblog2022.github.io/2022/06/04/study/MyBatis/</id>
    <published>2022-06-04T08:59:00.000Z</published>
    <updated>2022-06-06T09:27:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>MyBatis学习</p><span id="more"></span><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p><code>Mybatis</code> 是一款优秀的持久层框架，支持定制化<code>SQL</code>、存储过程及高级映射，可以使用简单的<code>XML</code>或注解来配置和映射原生信息</p><p>是一款半自动的持久层的半自动<code>ORM</code>映射框架</p><h3 id="1-1-框架"><a href="#1-1-框架" class="headerlink" title="1.1 框架"></a>1.1 框架</h3><ul><li>框架是一个基本概念上的结构，用于解决或处理复杂的问题。</li><li>使用框架的优点：减少开发时间，降低开发难度，保证设计质量，降低程序员之间的沟通以及日后维护的成本</li><li>框架是一个半成品，已经对基础的代码进行了封装并提供响应的<code>API</code>，开发者再使用框架是直接调用封装好的<code>API</code>，可以省去很多代码编写，从而提升效率和开发速度</li></ul><h3 id="1-2-ORM"><a href="#1-2-ORM" class="headerlink" title="1.2 ORM"></a>1.2 <code>ORM</code></h3><ul><li><code>Object-Relation Mapping</code>，对象关系映射</li><li>它的作用是在关系型数据库和对象之间做一个映射，这样在操作具体数据的时候就像操作对象一样</li></ul><h4 id="1-2-1-持久化"><a href="#1-2-1-持久化" class="headerlink" title="1.2.1 持久化"></a>1.2.1 持久化</h4><ul><li>持久：把数据保存到可永久保存的存储设备中</li><li>主要应用：将内存中的数据存储在关系型数据库中</li></ul><h4 id="1-2-2-持久层"><a href="#1-2-2-持久层" class="headerlink" title="1.2.2 持久层"></a>1.2.2 持久层</h4><ul><li>专注于实现数据持久化应用领域的某一个特定系统的一个逻辑层面，将数据使用者和数据实体想关联（<code>mapper</code>层、<code>DAO</code>层）</li></ul><h2 id="2、Mybatis配置"><a href="#2、Mybatis配置" class="headerlink" title="2、Mybatis配置"></a>2、<code>Mybatis</code>配置</h2><h3 id="2-1-事务"><a href="#2-1-事务" class="headerlink" title="2.1 事务"></a>2.1 事务</h3><p>​在<code>MyBatis</code> 核心配置文件中<code>envirment</code> 中通过<code>transactionManager</code>配置事务的处理策略</p><ul><li><code>JDBC</code>：该配置使用了<code>JDBC</code>的提交及回滚，依赖于从数据源得到的链接来管理事务范围</li><li><code>MANAGED</code>：该配置几乎无任何操作，不提交或回滚一个链接，它会让容器来管理整个生命周期（<code>Spring</code>应用服务器的上下文），默认情况下会关闭链接，但一些容器不希望如此，因此如果需要从链接中停止它，将<code>closeConnection</code>的属性值设置为<code>false</code>，<code>Mybatis</code>本身并不会处理事务，而是交给其他框架去处理</li></ul><h3 id="2-2-映射文件的加载方式"><a href="#2-2-映射文件的加载方式" class="headerlink" title="2.2 映射文件的加载方式"></a>2.2 映射文件的加载方式</h3><ol><li><code>mapper</code>的映射文件的文件路径导入，使用的是<code>mapper</code>标签的<code>resource</code>属性</li><li>网络资源路径使用的是<code>mapper</code>的<code>url</code>属性</li><li>接口的全限定名导入使用的是<code>mapper</code>标签的<code>class</code>属性—–基于接口的代理模式</li><li>包扫描形式加载所有的<code>mapper</code>映射文件，使用的<code>package</code>标签</li></ol><h2 id="3、Mybatis-开发"><a href="#3、Mybatis-开发" class="headerlink" title="3、Mybatis 开发"></a>3、<code>Mybatis</code> 开发</h2><h3 id="3-1-传递参数"><a href="#3-1-传递参数" class="headerlink" title="3.1 传递参数"></a>3.1 传递参数</h3><ul><li><p><em>${} 代表mybatis底层使用Statment语句对象,参数是以字符串拼接的形式设置</em></p></li><li><p>#{} 代表mybatis底层使用的preparedStatment语句对象,参数使用?作为占位符处理，更常用</p></li></ul><h2 id="4、MyBatis代理模式开发"><a href="#4、MyBatis代理模式开发" class="headerlink" title="4、MyBatis代理模式开发"></a>4、<code>MyBatis</code>代理模式开发</h2><p>在<code>MyBatis</code>中提供了一种称为<code>Mapper</code>代理（接口绑定）的操作方式，在实际开发中也使用该方式</p><h3 id="4-1-原理浅析"><a href="#4-1-原理浅析" class="headerlink" title="4.1 原理浅析"></a>4.1 原理浅析</h3><p>​底层使用了动态代理模式，动态创建一个<code>Mapper</code>的一个代理对象并赋给接口使用</p><h2 id="5、动态SQL"><a href="#5、动态SQL" class="headerlink" title="5、动态SQL"></a>5、动态<code>SQL</code></h2><p>​<code>MyBatis</code>在简化操作方法上提出了动态<code>SQL</code>功能，将使用<code>Java</code>代码拼接<code>SQL</code>语句，改变为在<code>XML</code>映射文件中截止标签拼接<code>SQL</code>语句。相比而言，大大减少代码量，更灵活、有利于后期维护</p><p>​<code>MyBatis</code>中动态<code>SQL</code>是编写在<code>mapper.xml</code>中的，其语法和<code>JSTL</code>类似，但是却是基于强大的<code>OGNL</code>表达式实现的</p><p>​<code>MyBatis</code>也可以在注解中配置<code>SQL</code>，但是由于注解功能受限，尤其是对于复杂的<code>SQL</code>语句，可读性很差，所以较少使用</p><h3 id="5-1-If标签"><a href="#5-1-If标签" class="headerlink" title="5.1 If标签"></a>5.1 <code>If</code>标签</h3><p>条件查询，符合<code>if</code>的条件，则补充<code>SQL</code>语句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        select * from student where 1=1</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;stuno != null&quot;</span>&gt;</span></span><br><span class="line">            and stuno =#&#123;stuno&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;classname != null and classname != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and classname like concat(&#x27;%&#x27;,#&#123;classname&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-2-Where标签"><a href="#5-2-Where标签" class="headerlink" title="5.2 Where标签"></a>5.2 <code>Where</code>标签</h3><p>用于处理<code>where</code>关键字和<code>and</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStuByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    select * from student</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;stuno != null&quot;</span>&gt;</span></span><br><span class="line">            and stuno= #&#123;stuno&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;classname != null and classname != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and classname= #&#123;classname&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-3-Choose标签"><a href="#5-3-Choose标签" class="headerlink" title="5.3 Choose标签"></a>5.3 <code>Choose</code>标签</h3><p>前面的<code>when</code>条件成立  后面的  <code>when</code>就不再判断了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStuByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    select * from student</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;stuno != null&quot;</span>&gt;</span></span><br><span class="line">                and stuno= #&#123;stuno&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;classname != null and classname != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and classname= #&#123;classname&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-4-Set标签"><a href="#5-4-Set标签" class="headerlink" title="5.4  Set标签"></a>5.4 <code> Set</code>标签</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStuByCondtion&quot;</span> &gt;</span></span><br><span class="line">    update student</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;classname != null and classname != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            , classname =#&#123;classname&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;stuno != null &quot;</span>&gt;</span></span><br><span class="line">            , stuname =#&#123;stuname&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where stuno =#&#123;stuno&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-5-Trim标签"><a href="#5-5-Trim标签" class="headerlink" title="5.5 Trim标签"></a>5.5 <code>Trim</code>标签</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateStuByCondition&quot;</span> &gt;</span></span><br><span class="line">    update student</span><br><span class="line">    <span class="comment">&lt;!--prefix 要增加什么前缀</span></span><br><span class="line"><span class="comment">    prefixOverrides 要去除什么前缀</span></span><br><span class="line"><span class="comment">    suffix 要增加什么后缀</span></span><br><span class="line"><span class="comment">    suffixOverrides 要去除什么后缀</span></span><br><span class="line"><span class="comment">    set 是trim的一种特殊情况</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;set&quot;</span>  <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;stuname != null and stuname != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            stuname= #&#123;stuname&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;classname != null and classname != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            classname= #&#123;classname&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    where  stuno = #&#123;stuno&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-6-Bind标签"><a href="#5-6-Bind标签" class="headerlink" title="5.6 Bind标签"></a>5.6 <code>Bind</code>标签</h3><p>一般用于处理模糊查询的模板</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStuByClassName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;likePattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27;+param1+&#x27;%&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bind</span>&gt;</span></span><br><span class="line">    select * from student where classname like #&#123;classname&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="6、缓存"><a href="#6、缓存" class="headerlink" title="6、缓存"></a>6、缓存</h2><h3 id="6-1-一级缓存"><a href="#6-1-一级缓存" class="headerlink" title="6.1 一级缓存"></a>6.1 一级缓存</h3><p>​一级存储是<code>SqlSession</code>上的缓存，默认开启，是一种内存型缓存,不要求实体类对象实现<code>Serializable</code>接口</p><p>​缓存中的数据使用键值对形式存储数据</p><p>​<code>namespace+sqlid+args+offset&gt;&gt;&gt; hash</code>值作为键,查询出的结果作为值</p><img src="/2022/06/04/study/MyBatis/sqlsession.png" class="" title="sqlsession一级缓存 image"><h3 id="6-2-二级缓存"><a href="#6-2-二级缓存" class="headerlink" title="6.2 二级缓存"></a>6.2 二级缓存</h3><p>​二级缓存是以<code>namespace</code>为标记的缓存，可以是由一个<code>SqlSessionFactory</code>创建的<code>SqlSession</code>之间共享缓存数据。默认并不开启，要求实体类必须实现序列化接口</p><img src="/2022/06/04/study/MyBatis/sqlsession2.png" class="" title="sqlsession二级缓存 image"><p>注意：</p><p>​1、<code> MyBatis</code>的二级缓存的缓存介质有多种多样，而并不一定是在内存中，所以需要对<code>JavaBean</code>对象实现序列化接口。</p><p>​2、二级缓存是以 <code>namespace </code>为单位的，不同 <code>namespace</code> 下的操作互不影响</p><p>​3、加入<code>Cache</code>元素后，会对相应命名空间所有的<code>select</code>元素查询结果进行缓存，而其中的<code>insert</code>、<code>update</code>、<code>delete</code>在操作是会清空整个<code>namespace</code>的缓存</p><p>​4、<code>cache</code> 有一些可选的属性 <code>type</code>, <code>eviction</code>, <code>flushInterval</code>, <code>size</code>, <code>readOnly</code>, <code>blocking</code>。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;&quot;</span> <span class="attr">eviction</span>=<span class="string">&quot;&quot;</span><span class="attr">flushInterval</span>=<span class="string">&quot;&quot;</span><span class="attr">size</span>=<span class="string">&quot;&quot;</span><span class="attr">blocking</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>属性</th><th>含义</th><th>默认值</th></tr></thead><tbody><tr><td>type</td><td>自定义缓存类，要求实现org.apache.ibatis.cache.Cache接口</td><td>null</td></tr><tr><td>readOnly</td><td>是否只读  <br />true:给所有调用者返回缓存对象的相同实例。因此这些对象不能被修改。这提供了很重要的性能优势。<br />false:会返回缓存对象的拷贝(通过序列化) 。这会慢一些,但是安全</td><td>false</td></tr><tr><td>eviction</td><td>缓存策略<br />LRU（默认） – 最近最少使用：移除最长时间不被使用的对象。<br />FIFO – 先进先出：按对象进入缓存的顺序来移除它们。<br />SOFT – 软引用：基于垃圾回收器状态和软引用规则移除对象。<br />WEAK – 弱引用：更积极地基于垃圾收集器状态和弱引用规则移除对象。</td><td>LRU</td></tr><tr><td>flushInterval</td><td>刷新间隔，毫秒为单位。默认为null，也就是没有刷新间隔，只有执行update、insert、delete语句才会刷新</td><td>null</td></tr><tr><td>size</td><td>缓存对象个数</td><td>1024</td></tr><tr><td>blocking</td><td>是否使用阻塞性缓存BlockingCache<br />true：在查询缓存时锁住对应的Key，如果缓存命中了则会释放对应的锁，否则会在查询数据库以后再释放锁，保证只有一个线程到数据库中查找指定key对应的数据<br />false：不使用阻塞性缓存，性能更好</td><td>false</td></tr></tbody></table><p>​5、如果在加入<code>Cache</code>元素的前提下让个别<code>select </code>元素不使用缓存，可以使用<code>useCache</code>属性，设置为<code>false</code>。**<code>useCache</code>**控制当前sql语句是否启用缓存  <code>flushCache</code>控制当前<code>sql</code>执行一次后是否刷新缓存</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findStuByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span> <span class="attr">flushCache</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-3-三方缓存"><a href="#6-3-三方缓存" class="headerlink" title="6.3 三方缓存"></a>6.3 三方缓存</h3><ul><li>分布式缓存框架：我们系统为了提高系统并发和性能，一般对系统进行分布式部署（集群部署方式）不适用分布缓存， 缓存的数据在各个服务单独存储，不方便系统开发。所以要使用分布式缓存对缓存数据进行集中管理.<code>ehcache</code>,<code>redis </code>,<code>memcache</code>缓存框架。</li><li><code>Ehcache</code>：是一种广泛使用的开源<code>java</code>分布式缓存。主要面向通用缓存，<code>javaEE </code>和 轻量级容器。它具有内存和磁盘存储功能。被用于大型复杂分布式<code>web application</code>的</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;MyBatis学习&lt;/p&gt;</summary>
    
    
    
    <category term="学习" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="MyBatis" scheme="https://lyblog2022.github.io/categories/%E5%AD%A6%E4%B9%A0/MyBatis/"/>
    
    
    <category term="MyBatis" scheme="https://lyblog2022.github.io/tags/MyBatis/"/>
    
    <category term="学习" scheme="https://lyblog2022.github.io/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>518总结--post请求调用接口</title>
    <link href="https://lyblog2022.github.io/2022/05/18/dailysummary/20220518/dailysummary/"/>
    <id>https://lyblog2022.github.io/2022/05/18/dailysummary/20220518/dailysummary/</id>
    <published>2022-05-18T13:06:35.000Z</published>
    <updated>2022-06-21T13:37:46.917Z</updated>
    
    <content type="html"><![CDATA[<p>使用post方式调用接口并传递参数</p> <span id="more"></span><h2 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.summary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.NameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.config.RequestConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.entity.StringEntity;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.message.BasicNameValuePair;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Summary</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 发送post请求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url：请求URL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> headerParamsJson：请求header参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> paramJson：请求参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> JSONObject <span class="title function_">sendData</span><span class="params">(String url, JSONObject headerParamsJson, JSONObject paramJson)</span> &#123;</span><br><span class="line"><span class="type">JSONObject</span> <span class="variable">resultJson</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送post请求</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">HttpPost</span> <span class="variable">httppost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line"><span class="type">RequestConfig</span> <span class="variable">defaultRequestConfig</span> <span class="operator">=</span> RequestConfig.custom().setConnectTimeout(<span class="number">5000</span>)</span><br><span class="line">.setConnectionRequestTimeout(<span class="number">5000</span>).setSocketTimeout(<span class="number">15000</span>).build();</span><br><span class="line">httppost.setConfig(defaultRequestConfig);</span><br><span class="line"><span class="type">StringEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(paramJson.toJSONString(), <span class="string">&quot;utf-8&quot;</span>);<span class="comment">// 解决中文乱码问题</span></span><br><span class="line">entity.setContentEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">entity.setContentType(<span class="string">&quot;text/json&quot;</span>);</span><br><span class="line">httppost.setEntity(entity);</span><br><span class="line">httppost.setHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加header参数</span></span><br><span class="line"><span class="type">Iterator</span> <span class="variable">headerParamsIterator</span> <span class="operator">=</span> headerParamsJson.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (headerParamsIterator.hasNext()) &#123;</span><br><span class="line">Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) headerParamsIterator.next();</span><br><span class="line">httppost.setHeader(entry.getKey().toString(), entry.getValue().toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 装填参数</span></span><br><span class="line">List&lt;NameValuePair&gt; nvps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;NameValuePair&gt;();</span><br><span class="line"><span class="keyword">if</span> (paramJson != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> paramJson.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) iterator.next();</span><br><span class="line">nvps.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>((String) entry.getKey(), (String) entry.getValue()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">UrlEncodedFormEntity</span> <span class="variable">reqEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(nvps, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">httppost.setEntity(reqEntity);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行post请求.</span></span><br><span class="line"><span class="type">CloseableHttpClient</span> <span class="variable">httpclient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"><span class="type">CloseableHttpResponse</span> <span class="variable">response1</span> <span class="operator">=</span> httpclient.execute(httppost);</span><br><span class="line"><span class="type">String</span> <span class="variable">resultText</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response1.getStatusLine().getStatusCode();</span><br><span class="line"><span class="keyword">if</span> (statusCode != <span class="number">200</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;请求失败&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 响应实体</span></span><br><span class="line"><span class="type">HttpEntity</span> <span class="variable">entity2</span> <span class="operator">=</span> response1.getEntity();</span><br><span class="line"><span class="keyword">if</span> (entity2 != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// 响应内容</span></span><br><span class="line">resultText = EntityUtils.toString(entity2, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">resultJson = JSONObject.parseObject(resultText);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">resultJson.put(<span class="string">&quot;code&quot;</span>, statusCode);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">response1.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">resultJson.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;410&quot;</span>);</span><br><span class="line">resultJson.put(<span class="string">&quot;err&quot;</span>, e.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> resultJson;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;使用post方式调用接口并传递参数&lt;/p&gt;</summary>
    
    
    
    <category term="那些代码那些总结" scheme="https://lyblog2022.github.io/categories/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E9%82%A3%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
    
    <category term="接口调用" scheme="https://lyblog2022.github.io/categories/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E9%82%A3%E4%BA%9B%E6%80%BB%E7%BB%93/%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/"/>
    
    
    <category term="httpClient" scheme="https://lyblog2022.github.io/tags/httpClient/"/>
    
    <category term="那些代码那些总结" scheme="https://lyblog2022.github.io/tags/%E9%82%A3%E4%BA%9B%E4%BB%A3%E7%A0%81%E9%82%A3%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
    
    <category term="接口调用" scheme="https://lyblog2022.github.io/tags/%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8/"/>
    
  </entry>
  
</feed>
